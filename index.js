!function(e){var t={};function r(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(i,o,function(t){return e[t]}.bind(null,o));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=48)}([function(e,t){e.exports=require("mongoose")},function(e,t){e.exports={WritePosCobot:[],resultImage:[],refreshDataBitDisplayImageLibrary:!1,resultBitDisplayImageLibrary:[],refreshDataElementImageLibrary:!1,resultElementImageLibrary:[],refreshDataElement:!1,refreshDataBitAdjust:!1,refreshDataBitDisplay:!1,refreshDataWordAdjust:!1,refreshDataWordDisplay:!1,refreshDataDWordAdjust:!1,refreshDataDWordDisplay:!1,refreshDataImage:!1,refreshDataLabel:!1,refreshDataLine:!1,refreshDataPoint:!1,refreshDataPointPickPlace:!1,refreshDataPanel:!1,refreshDataTextField:!1,refreshDataTextFieldInput:!1,haveChangeElement:!1,haveChangeBitAdjust:!1,haveChangeBitDisplay:!1,haveChangeWordAdjust:!1,haveChangeWordDisplay:!1,haveChangeDWordAdjust:!1,haveChangeDWordDisplay:!1,haveChangeTextField:!1,haveChangeTextFieldInput:!1,Element:[],OldElement:[],ElementOmron:[],WordStartElementOmron:0,LengthOfElementOmron:100,BitDisplay:[],BitAdjust:[],WordDisplay:[],WordAdjust:[],DWordDisplay:[],DWordAdjust:[],OldBitDisplay:[],OldBitAdjust:[],OldWordDisplay:[],OldWordAdjust:[],OldDWordDisplay:[],OldDWordAdjust:[],TextField:[],OldTextField:[],TextFieldInput:[],OldTextFieldInput:[],IndexSocketInputSignal:2,IndexSocketBitAdjust:4,IndexSocketBitDisplay:3,IndexSocketWordDisplay:5,IndexSocketWordAdjust:6,IndexSocketDWordDisplay:7,IndexSocketDWordAdjust:8,CheckBitDisplay:"",CheckBitAdjust:"",CheckWordDisplay:"",CheckWordAdjust:"",CheckDWordDisplay:"",CheckDWordAdjust:"",resultlabel:[],resultline:[],resultElement:[],resultBitDisplay:[],resultBitAdjust:[],resultWordDisplay:[],resultWordAdjust:[],resultDWordDisplay:[],resultDWordAdjust:[],resultPanel:[],resultTextField:[],resultTextFieldInput:[],resultcustomeroperator:void 0,refreshdata:void 0,CustomerOperator:void 0,BitDisplayOMRON:[],WordStartBitDisplayOMRON:300,LengthOfWordBitDisplayOMRON:10,BitAdjustOMRON:[],WordStartBitAdjustOMRON:310,LengthOfWordBitAdjustOMRON:10,WordDisplayOMRON:[],WordStartWordDisplayOMRON:320,LengthOfWordWordDisplayOMRON:200,WordAdjustOMRON:[],WordStartWordAdjustOMRON:520,LengthOfWordWordAdjustOMRON:200,DWordDisplayOMRON:[],WordStartDWordDisplayOMRON:720,LengthOfWordDWordDisplayOMRON:25,DWordAdjustOMRON:[],WordStartDWordAdjustOMRON:770,LengthOfWordDWordAdjustOMRON:25,ElementMitsubishi:[],BitDisplayMitsubishi:[],BitAdjustMitsubishi:[],WordDisplayMitsubishi:[],WordAdjustMitsubishi:[],DWordDisplayMitsubishi:[],DWordAdjustMitsubishi:[],refreshDataPosCobot:!1,resultPosCobot:[]}},function(e,t){e.exports=require("stampit")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("bluebird")},function(e,t,r){e.exports={ReadWordOfPlcToByte:function(e,t,r){for(var i=[],o=e;o<e+t;o++){var n=255&r[o];i[2*(o-e)]=n,r[o]=(r[o]-n)/256,i[2*(o-e)+1]=r[o]}return i},StringToAscii:function(e){for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);var i=[],o=0,n=0;for(r=0;r<t.length;r++)r%2==0&&(n=t[r],r+1===t.length&&(i[o]=n)),r%2==1&&(n+=256*t[r],i[o]=n,o+=1);return i},ReadBitOfPLC:function(e,t,r){for(var i=[],o=e;o<e+t;o++)for(var n=Number(r[o]),s=0;s<16;s++)i[16*(o-e)+s]=1&n,n>>=1;return i},ReadWordOfPLC:function(e,t,r){for(var i=[],o=e;o<e+t;o++)i[o-e]=r[o];return i},ReadDWordOfPLC:function(e,t,r){for(var i=[],o=e;o<e+2*t;o++)o%2==1&&(i[(o-e-1)/2]=65536*r[o]+r[o-1],i[(o-e-1)/2]<0&&(i[(o-e-1)/2]=i[(o-e-1)/2]+65536));return i},ConvertArray2Text:function(e){for(var t="",r=0;r<e.length;r++)t=t+"|"+e[r];return t},CheckChangeValue:function(e,t){var r,i=!1;if(!(void 0===(r=e)||null==r||r.length<=0))for(var o=0;o<e.length;o++)e[o]!=t[o]&&(i=!0);return i},CheckNegativeNumber:function(e){return e<0?e+65536:e>32767?e-65536:e},getRandomInt:function(e){return Math.floor(Math.random()*Math.floor(e))},saveJsonFile:function(e,t){const i=r(6);try{i.existsSync(e)||i.writeFile(e,JSON.stringify(t),"utf8",(function(e){if(e)return console.log("An error occured while writing JSON Object to File."),console.log(e);console.log("JSON file has been saved.")}))}catch(e){console.error(e)}},getJsonFile:function(e,t){const i=r(6);try{i.existsSync(e)?i.readFile(e,"utf8",(function(e,r){e&&console.log(e),obj=JSON.parse(r),t(obj)})):t("update")}catch(e){console.error(e),t([])}},saveFeedbackFile:function(e,t){const i=r(6);try{i.writeFile(e,t,"utf8",(function(e){if(e)return console.log("An error occured while writing JSON Object to File."),console.log(e);console.log("JSON file has been saved.")}))}catch(e){console.error(e)}},convertPosCobot:function(e,t){var r=[];return r[0]=parseInt(t%256),r[1]=parseInt(t/256),r[2]=parseInt(e%256),r[3]=parseInt(e/256),Buffer.from([r[3],r[2],r[1],r[0]]).readFloatBE(0)},getIndexCobotWriteMB:function(e,t){return t%10<=e?t/10:t/10+1}}},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("net")},function(e,t){e.exports=require("util")},function(e,t){e.exports=require("stampit-log")},function(e,t,r){var i={"./ReadCoils":29,"./ReadCoils.js":29,"./ReadDiscreteInputs":30,"./ReadDiscreteInputs.js":30,"./ReadHoldingRegisters":31,"./ReadHoldingRegisters.js":31,"./ReadInputRegisters":32,"./ReadInputRegisters.js":32,"./WriteMultipleCoils":33,"./WriteMultipleCoils.js":33,"./WriteMultipleRegisters":34,"./WriteMultipleRegisters.js":34,"./WriteSingleCoil":35,"./WriteSingleCoil.js":35,"./WriteSingleRegister":36,"./WriteSingleRegister.js":36};function o(e){var t=n(e);return r(t)}function n(e){if(!r.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}o.keys=function(){return Object.keys(i)},o.resolve=n,e.exports=o,o.id=10},function(e,t){e.exports=require("config")},function(e,t){e.exports=require("path")},function(e,t,r){var i=r(0),o=new(0,i.Schema)({type:{type:Number,required:!0},number:{type:Number,required:!0},offsetInX:{type:Number,required:!0},offsetInY:{type:Number,required:!0},offsetInZ:{type:Number,required:!0},offsetInR:{type:Number,required:!0},offsetInAddX:{type:Number,required:!0},offsetInAddY:{type:Number,required:!0},PlaceX:{type:Number,required:!0},PlaceY:{type:Number,required:!0}});e.exports=i.model("points",o)},function(e,t,r){var i=r(0),o=new(0,i.Schema)({parent:{type:String,default:""},tag:{type:String,required:!0},left:{type:Number,required:!0},top:{type:Number,required:!0},nameElement:{type:String,default:""},src:{type:String,required:!0},state_m:{type:Number,default:0},state_cm:{type:Number,default:0},state_F0:{type:Number,default:0},state_F1:{type:Number,default:0},state_Fault:{type:Number,default:0},state_Interlock:{type:Number,default:0}});e.exports=i.model("elements",o)},function(e,t,r){var i=r(0),o=new(0,i.Schema)({parent:{type:String,default:""},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},text:{type:String,required:!0},color:{type:String,default:"black"},fontSize:{type:Number,default:14}});e.exports=i.model("labels",o)},function(e,t,r){var i=r(0),o=new(0,i.Schema)({parent:{type:String,default:""},left:{type:Number,required:!0},top:{type:Number,required:!0},length:{type:Number,required:!0},type:{type:String,required:!0},idRun:{type:String,default:""}});e.exports=i.model("lines",o)},function(e,t,r){var i=r(0),o=new(0,i.Schema)({parent:{type:String,default:""},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},text:{type:String,required:!0},tag:{type:String,required:!0},fontSize:{type:String,required:!0}});e.exports=i.model("wordDisplays",o)},function(e,t,r){var i=r(0),o=new(0,i.Schema)({parent:{type:String,default:""},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},height:{type:Number,required:!0},text:{type:String,required:!0},tag:{type:String,required:!0},fontSize:{type:String,required:!0}});e.exports=i.model("wordAdjusts",o)},function(e,t,r){var i=r(0),o=new(0,i.Schema)({parent:{type:String,default:""},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},text:{type:String,required:!0},tag:{type:String,required:!0},fontSize:{type:String,required:!0}});e.exports=i.model("dwordDisplays",o)},function(e,t,r){var i=r(0),o=new(0,i.Schema)({parent:{type:String,default:""},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},height:{type:Number,required:!0},text:{type:String,required:!0},tag:{type:String,required:!0},fontSize:{type:String,required:!0}});e.exports=i.model("dwordAdjusts",o)},function(e,t,r){var i=r(0),o=new(0,i.Schema)({parent:{type:String,default:""},status:{type:Boolean,default:!1},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},text0:{type:String,default:""},text1:{type:String,default:""},color0:{type:String,default:""},color1:{type:String,default:""},nameImage0:{type:String,default:""},nameImage1:{type:String,default:""},tag:{type:String,required:!0},type:{type:Number,required:!0},fontSize:{type:Number,default:14,required:!1}});e.exports=i.model("bitDisplays",o)},function(e,t,r){var i=r(0),o=new(0,i.Schema)({parent:{type:String,default:""},status:{type:Boolean,default:!1},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},height:{type:Number,required:!0},text:{type:String,default:""},tag:{type:String,required:!0},type:{type:Number,required:!0},fontSize:{type:Number,default:14}});e.exports=i.model("bitAdjusts",o)},function(e,t,r){var i=r(0),o=new(0,i.Schema)({parent:{type:String,default:""},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},height:{type:Number,required:!0},backgroundColor:{type:String,default:"#4c7549"},borderRadius:{type:Number,default:5},boxShadow1:{type:Number,default:10},boxShadow2:{type:Number,default:10},boxShadow3:{type:Number,default:20},boxShadowColor:{type:String,default:"#100"},zIndex:{type:Number,default:0},margin:{type:Number,default:10},padding:{type:Number,default:10}});e.exports=i.model("panels",o)},function(e,t,r){var i=r(0),o=new(0,i.Schema)({parent:{type:String,default:""},tag:{type:String,required:!0},label:{type:String,required:!0},value:{type:String,required:!0},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},color:{type:String,required:!0},fontSize:{type:Number,required:!0},rows:{type:Number,required:!0}});e.exports=i.model("textFields",o)},function(e,t,r){var i=r(0),o=new(0,i.Schema)({parent:{type:String,default:""},tag:{type:String,required:!0},label:{type:String,required:!0},value:{type:String,required:!0},left:{type:Number,required:!0},top:{type:Number,required:!0},width:{type:Number,required:!0},color:{type:String,required:!0},fontSize:{type:Number,required:!0},rows:{type:Number,required:!0}});e.exports=i.model("textFieldInputs",o)},function(e,t,r){var i=r(0),o=new(0,i.Schema)({name:{type:String,default:""},img:{type:String,default:""},date:{type:Date,default:new Date}});e.exports=i.model("bitDisplay_Image_Library",o)},function(e,t,r){var i=r(0),o=new(0,i.Schema)({name:{type:String,unique:!0,default:""},imgRun:{type:String,default:""},imgStop:{type:String,default:""},imgLock:{type:String,default:""},imgFault:{type:String,default:""},date:{type:Date,default:Date.now,timestamps:!0}});e.exports=i.model("element_Image_Library",o)},function(e,t){e.exports=require("stampit-state-machine")},function(e,t,r){"use strict";var i=r(2),o=r(4);e.exports=i().init((function(){var e=function(){this.addResponseHandler(1,t)}.bind(this),t=function(e,t){this.log.debug("handling read coils response.");var r=e.readUInt8(0),i=e.readUInt8(1),o={fc:r,byteCount:i,payload:e.slice(2),coils:[]};if(1===r){for(var n=0,s=0;s<i;s+=1)for(var a=1,d=e.readUInt8(2+s),l=0;l<8;l+=1)o.coils[n]=(d&a)>0,a<<=1,n+=1;t.defer.resolve(o)}else t.defer.reject(new Error("received unexpected function code"))}.bind(this);this.readCoils=function(e,t){return new o(function(r,i){var o=Buffer.allocUnsafe(5);o.writeUInt8(1,0),o.writeUInt16BE(e,1),o.writeUInt16BE(t,3),this.queueRequest(1,o,{resolve:r,reject:i})}.bind(this))},e()}))},function(e,t,r){"use strict";var i=r(2),o=r(4);e.exports=i().init((function(){var e=function(){this.addResponseHandler(2,t)}.bind(this),t=function(e,t){this.log.debug("handling read discrete inputs response.");var r=e.readUInt8(0),i=e.readUInt8(1),o=0,n={fc:r,byteCount:i,payload:e.slice(2),coils:[]};if(2===r){for(var s=0;s<i;s+=1)for(var a=1,d=e.readUInt8(2+s),l=0;l<8;l+=1)n.coils[o]=(d&a)>0,a<<=1,o+=1;t.defer.resolve(n)}else t.defer.reject(new Error("received unexpected function code"))}.bind(this);this.readDiscreteInputs=function(e,t){return new o(function(r,i){var o=Buffer.allocUnsafe(5);o.writeUInt8(2),o.writeUInt16BE(e,1),o.writeUInt16BE(t,3),t>2e3?i():this.queueRequest(2,o,{resolve:r,reject:i})}.bind(this))},e()}))},function(e,t,r){"use strict";var i=r(2),o=r(4);e.exports=i().init((function(){var e=function(){this.addResponseHandler(3,t)}.bind(this),t=function(e,t){this.log.debug("handling read holding registers response.");var r=e.readUInt8(0),i=e.readUInt8(1),o={fc:r,byteCount:i,payload:e.slice(2),register:[]};if(3===r){for(var n=i/2,s=0;s<n;s+=1)o.register.push(e.readUInt16BE(2+2*s));t.defer.resolve(o)}else t.defer.reject(new Error("received unexpected function code"))}.bind(this);this.readHoldingRegisters=function(e,t){return new o(function(r,i){this.log.debug("Starting read holding registers request.");var o=Buffer.allocUnsafe(5);o.writeUInt8(3),o.writeUInt16BE(e,1),o.writeUInt16BE(t,3),this.queueRequest(3,o,{resolve:r,reject:i})}.bind(this))},e()}))},function(e,t,r){"use strict";var i=r(2),o=r(4);e.exports=i().init((function(){var e=function(){this.addResponseHandler(4,t)}.bind(this),t=function(e,t){this.log.debug("handling read input registers response.");var r=e.readUInt8(0),i=e.readUInt8(1),o={fc:r,byteCount:i,payload:e.slice(2),register:[]};if(4===r){for(var n=i/2,s=0;s<n;s+=1)o.register.push(e.readUInt16BE(2+2*s));t.defer.resolve(o)}else t.defer.reject(new Error("received unexpected function code"))}.bind(this);this.readInputRegisters=function(e,t){return new o(function(r,i){var o=Buffer.allocUnsafe(5);o.writeUInt8(4),o.writeUInt16BE(e,1),o.writeUInt16BE(t,3),this.queueRequest(4,o,{resolve:r,reject:i})}.bind(this))},e()}))},function(e,t,r){"use strict";var i=r(2),o=r(4);e.exports=i().init((function(){var e=function(){this.addResponseHandler(15,t)}.bind(this),t=function(e,t){this.log.debug("handling multiple coils response.");var r=e.readUInt8(0),i={fc:r,startAddress:e.readUInt16BE(1),quantity:e.readUInt16BE(3)};15===r?t.defer.resolve(i):t.defer.reject(new Error("received unexpected function code"))}.bind(this);this.writeMultipleCoils=function(e,t,r){return new o(function(i,o){var n,s=Buffer.allocUnsafe(6);if(s.writeUInt8(15,0),s.writeUInt16BE(e,1),t instanceof Buffer)s.writeUInt16BE(r,3),s.writeUInt8(t.length,5),n=Buffer.concat([s,t]);else if(t instanceof Array){if(t.length>1968)return void o();var a=Math.ceil(t.length/8),d=0,l=0,u=0,c=Buffer.allocUnsafe(a);s.writeUInt16BE(t.length,3),s.writeUInt8(a,5);for(var f=0;f<t.length;f+=1)d+=t[f]?Math.pow(2,u):0,0!==(u=(u+1)%8)&&f!==t.length-1||(c.writeUInt8(d,l),l+=1,d=0);n=Buffer.concat([s,c])}this.queueRequest(15,n,{resolve:i,reject:o})}.bind(this))},e()}))},function(e,t,r){"use strict";var i=r(2),o=r(4);e.exports=i().init((function(){var e=function(){this.addResponseHandler(16,t)}.bind(this),t=function(e,t){this.log.debug("handling multiple registers response.");var r=e.readUInt8(0),i={fc:r,startAddress:e.readUInt16BE(1),quantity:e.readUInt16BE(3)};16===r?t.defer.resolve(i):t.defer.reject(new Error("received unexpected function code"))}.bind(this);this.writeMultipleRegisters=function(e,t){return new o(function(r,i){var o,n=Buffer.allocUnsafe(6);if(n.writeUInt8(16),n.writeUInt16BE(e,1),t instanceof Buffer)t.length/2>123&&i(),n.writeUInt16BE(t.length/2,3),n.writeUInt8(t.length,5),o=Buffer.concat([n,t]);else{if(!(t instanceof Array))return void i();if(t.length>123)return void i();var s=Math.ceil(2*t.length),a=Buffer.allocUnsafe(s);n.writeUInt16BE(t.length,3),n.writeUInt8(s,5);for(var d=0;d<t.length;d+=1)a.writeUInt16BE(t[d],2*d);o=Buffer.concat([n,a])}this.queueRequest(16,o,{resolve:r,reject:i})}.bind(this))},e()}))},function(e,t,r){"use strict";var i=r(2),o=r(4);e.exports=i().init((function(){var e=function(){this.addResponseHandler(5,t)}.bind(this),t=function(e,t){this.log.debug("handling write single coil response.");var r=e.readUInt8(0),i=e.readUInt16BE(1),o=e.readUInt16BE(3),n={fc:r,outputAddress:i,outputValue:0!==o&&(65280===o||void 0)};5===r?t.defer.resolve(n):t.defer.reject(new Error("received unexpected function code"))}.bind(this);this.writeSingleCoil=function(e,t){return new o(function(r,i){var o=t instanceof Buffer?t.readUInt8(0)>0:t,n=Buffer.allocUnsafe(5);n.writeUInt8(5,0),n.writeUInt16BE(e,1),n.writeUInt16BE(o?65280:0,3),this.queueRequest(5,n,{resolve:r,reject:i})}.bind(this))},e()}))},function(e,t,r){"use strict";var i=r(2),o=r(4);e.exports=i().init((function(){var e=function(){this.addResponseHandler(6,t)}.bind(this),t=function(e,t){this.log.debug("handling write single register response.");var r=e.readUInt8(0),i={fc:r,registerAddress:e.readUInt16BE(1),registerValue:e.readUInt16BE(3),registerAddressRaw:e.slice(1,3),registerValueRaw:e.slice(3,5)};6===r?t.defer.resolve(i):t.defer.reject(new Error("received unexpected function code"))}.bind(this);this.writeSingleRegister=function(e,t){return new o(function(r,i){var o=t instanceof Buffer?t.readUInt16BE(0):t,n=Buffer.allocUnsafe(5);n.writeUInt8(6,0),n.writeUInt16BE(e,1),n.writeUInt16BE(o,3),this.queueRequest(6,n,{resolve:r,reject:i})}.bind(this))},e()}))},function(e,t,r){"use strict";var i=r(2),o=r(86),n=r(28),s=r(88);e.exports=i().compose(o).compose(n).init((function(){let e,t=[],i=[],o=[],n=function(){this.port||(this.port=502),this.hostname||(this.hostname="0.0.0.0");let t=this.injNet||r(7);e=t.createServer(),e.on("connection",function(e){let t=e.address();if(this.log.debug("new connection",t),this.whiteListIPs&&this.whiteListIPs.indexOf(t.address)<0)return this.log.debug("client connection REJECTED",t),e.end(),!1;o.push(e),d(e)}.bind(this)),e.listen(this.port,this.hostname,function(e){if(e)return this.log.debug("error while listening",e),void this.emit("error",e)}.bind(this)),this.log.debug("server is listening on port",this.hostname+":"+this.port),this.on("newState_ready",a),this.setState("ready")}.bind(this);var a=function(){if(!this.inState("processing")&&0!==i.length){this.setState("processing");var e=i.shift();this.onData(e.pdu,function(t){this.log.debug("sending tcp data");var r=Buffer.allocUnsafe(7);r.writeUInt16BE(e.request.trans_id,0),r.writeUInt16BE(e.request.protocol_ver,2),r.writeUInt16BE(t.length+1,4),r.writeUInt8(e.request.unit_id,6);var i=Buffer.concat([r,t]);e.socket.write(i),this.setState("ready")}.bind(this))}}.bind(this),d=function(e){let r=t.length;var o=function(){t[r]=void 0;for(let e=t.length-1;e>=0;e-=1){if(void 0!==t[e])break;t.splice(e,1)}this.log.debug("Client connection closed, remaining clients. ",t.length)}.bind(this);let n=s({socket:e,socketId:r,onRequest:function(e){i.push(e),a()},onEnd:o});t.push(n)}.bind(this);this.close=function(t){for(var r in o)o[r].destroy();e.close((function(){e.unref(),t&&t()}))},n()}))},function(e,t,r){var i={"./ReadCoils":39,"./ReadCoils.js":39,"./ReadDiscreteInputs":40,"./ReadDiscreteInputs.js":40,"./ReadHoldingRegisters":41,"./ReadHoldingRegisters.js":41,"./ReadInputRegisters":42,"./ReadInputRegisters.js":42,"./WriteMultipleCoils":43,"./WriteMultipleCoils.js":43,"./WriteMultipleRegisters":44,"./WriteMultipleRegisters.js":44,"./WriteSingleCoil":45,"./WriteSingleCoil.js":45,"./WriteSingleRegister":46,"./WriteSingleRegister.js":46};function o(e){var t=n(e);return r(t)}function n(e){if(!r.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}o.keys=function(){return Object.keys(i)},o.resolve=n,e.exports=o,o.id=38},function(e,t,r){"use strict";var i=r(2);e.exports=i().init((function(){var e=function(){this.log.debug("initiating read coils request handler."),this.responseDelay||(this.responseDelay=0),this.setRequestHandler(1,t)}.bind(this),t=function(e,t){setTimeout(function(){if(this.log.debug("handling read coils request."),5!==e.length){let e=Buffer.allocUnsafe(2);return e.writeUInt8(129,0),e.writeUInt8(2,1),void t(e)}var r=e.readUInt16BE(1),i=e.readUInt16BE(3);this.emit("readCoilsRequest",r,i);var o=this.getCoils();if(r>8*o.length||r+i>8*o.length){let e=Buffer.allocUnsafe(2);return e.writeUInt8(129,0),e.writeUInt8(2,1),void t(e)}var n=0,s=0,a=2,d=Math.ceil(i/8),l=Buffer.allocUnsafe(2+d);l.writeUInt8(1,0),l.writeUInt8(d,1);for(var u=r;u<r+i;u+=1){o.readUInt8(Math.floor(u/8))&1<<u%8&&(n+=1<<s%8),(s+=1)%8!=0&&u!==r+i-1||(l.writeUInt8(n,a),n=0,a+=1)}t(l)}.bind(this),this.responseDelay)}.bind(this);e()}))},function(e,t,r){"use strict";var i=r(2)().init((function(){var e=function(){this.log.debug("initiating read discrete inputs request handler."),this.responseDelay||(this.responseDelay=0),this.setRequestHandler(2,t)}.bind(this),t=function(e,t){setTimeout(function(){if(this.log.debug("handling read discrete inputs request."),5!==e.length){this.log.debug("wrong pdu length.");let e=Buffer.allocUnsafe(2);return e.writeUInt8(130,0),e.writeUInt8(2,1),void t(e)}var r=e.readUInt16BE(1),i=e.readUInt16BE(3);this.emit("readDiscreteInputsRequest",r,i);var o=this.getDiscrete();if(r>8*o.length||r+i>8*o.length){this.log.debug("wrong pdu length.");let e=Buffer.allocUnsafe(2);return e.writeUInt8(130,0),e.writeUInt8(2,1),void t(e)}var n=0,s=0,a=2,d=Math.ceil(i/8),l=Buffer.allocUnsafe(2+d);l.writeUInt8(2,0),l.writeUInt8(d,1);for(var u=r;u<r+i;u+=1){o.readUInt8(Math.floor(u/8))&1<<u%8&&(n+=1<<s%8),(s+=1)%8!=0&&u!==r+i-1||(l.writeUInt8(n,a),n=0,a+=1)}t(l)}.bind(this),this.responseDelay)}.bind(this);e()}));e.exports=i},function(e,t,r){"use strict";var i=r(2);e.exports=i().init((function(){var e=function(){this.log.debug("initiating read holding registers request handler."),this.responseDelay||(this.responseDelay=0),this.setRequestHandler(3,t)}.bind(this),t=function(e,t){setTimeout(function(){if(this.log.debug("handling read holding registers request."),5!==e.length){this.log.debug("wrong pdu length.");let e=Buffer.allocUnsafe(2);return e.writeUInt8(131,0),e.writeUInt8(2,1),void t(e)}var r=2*e.readUInt16BE(1),i=e.readUInt16BE(3);this.emit("readHoldingRegistersRequest",r,i);var o=this.getHolding();if(r>o.length||r+2*i>o.length){this.log.debug("request outside register boundaries.");let e=Buffer.allocUnsafe(2);return e.writeUInt8(131,0),e.writeUInt8(2,1),void t(e)}var n=Buffer.allocUnsafe(2);n.writeUInt8(3,0),n.writeUInt8(2*i,1);var s=Buffer.concat([n,o.slice(r,r+2*i)]);this.log.debug("finished read holding register request."),t(s)}.bind(this),this.responseDelay)}.bind(this);e()}))},function(e,t,r){"use strict";var i=r(2);e.exports=i().init((function(){var e=function(){this.log.debug("initiating read input registers request handler."),this.responseDelay||(this.responseDelay=0),this.setRequestHandler(4,t)}.bind(this),t=function(e,t){setTimeout(function(){if(this.log.debug("handling read input registers request."),5!==e.length){let e=Buffer.allocUnsafe(2);return e.writeUInt8(132,0),e.writeUInt8(2,1),void t(e)}var r=2*e.readUInt16BE(1),i=e.readUInt16BE(3);this.emit("readInputRegistersRequest",r,i);var o=this.getInput();if(r>o.length||r+2*i>o.length){let e=Buffer.allocUnsafe(2);return e.writeUInt8(132,0),e.writeUInt8(2,1),void t(e)}var n=Buffer.allocUnsafe(2);n.writeUInt8(4,0),n.writeUInt8(2*i,1);var s=Buffer.concat([n,o.slice(r,r+2*i)]);t(s)}.bind(this),this.responseDelay)}.bind(this);e()}))},function(e,t,r){"use strict";var i=r(2);e.exports=i().init((function(){var e=function(){this.log.debug("initiating write multiple coils request handler."),this.responseDelay||(this.responseDelay=0),this.setRequestHandler(15,t)}.bind(this),t=function(e,t){setTimeout(function(){if(this.log.debug("handling write multiple coils request."),e.length<3){let e=Buffer.allocUnsafe(2);return e.writeUInt8(143,0),e.writeUInt8(2,1),void t(e)}var r=e.readUInt16BE(1),i=e.readUInt16BE(3),o=e.readUInt8(5);this.emit("preWriteMultipleCoilsRequest",r,i,o);var n=this.getCoils();if(r>8*n.length||r+i>8*n.length){let e=Buffer.allocUnsafe(2);return e.writeUInt8(143,0),e.writeUInt8(2,1),void t(e)}var s,a,d=Buffer.allocUnsafe(5);d.writeUInt8(15,0),d.writeUInt16BE(r,1),d.writeUInt16BE(i,3);for(var l=e.readUInt8(6),u=0,c=r;c<r+i;c+=1)s=n.readUInt8(Math.floor(c/8)),a=Math.pow(2,u%8)&l?s|Math.pow(2,c%8):s&~Math.pow(2,c%8),n.writeUInt8(a,Math.floor(c/8)),(u+=1)%8==0&&u<i&&(l=e.readUInt8(6+Math.floor(u/8)));this.emit("postWriteMultipleCoilsRequest",r,i,o),t(d)}.bind(this),this.responseDelay)}.bind(this);e()}))},function(e,t,r){"use strict";var i=r(2);e.exports=i().init((function(){var e=function(){this.log.debug("initiating write multiple registers request handler."),this.responseDelay||(this.responseDelay=0),this.setRequestHandler(16,t)}.bind(this),t=function(e,t){setTimeout(function(){if(this.log.debug("handling write multiple registers request."),e.length<3){let e=Buffer.allocUnsafe(2);return e.writeUInt8(144,0),e.writeUInt8(2,1),void t(e)}var r=e.readUInt16BE(1),i=2*r,o=e.readUInt16BE(3),n=e.readUInt8(5);if(o>123){let e=Buffer.allocUnsafe(2);return e.writeUInt8(144,0),e.writeUInt8(3,1),void t(e)}this.emit("preWriteMultipleRegistersRequest",i,o,n);var s=this.getHolding();if(i>s.length||i+2*o>s.length){var a=Buffer.allocUnsafe(2);return a.writeUInt8(144,0),a.writeUInt8(2,1),void t(a)}var d=Buffer.allocUnsafe(5);d.writeUInt8(16,0),d.writeUInt16BE(r,1),d.writeUInt16BE(o,3),e.copy(s,i,6,6+n),this.emit("postWriteMultipleRegistersRequest",i,o,n),t(d)}.bind(this),this.responseDelay)}.bind(this);e()}))},function(e,t,r){"use strict";var i=r(2);e.exports=i().init((function(){var e=function(){this.log.debug("initiating write single coil request handler."),this.responseDelay||(this.responseDelay=0),this.setRequestHandler(5,t)}.bind(this),t=function(e,t){setTimeout(function(){if(this.log.debug("handling write single coil request."),5!==e.length){let e=Buffer.allocUnsafe(2);return e.writeUInt8(133,0),e.writeUInt8(2,1),void t(e)}var r=e.readUInt16BE(1),i=!(0===e.readUInt16BE(3));if(0!==e.readUInt16BE(3)&&65280!==e.readUInt16BE(3)){let e=Buffer.allocUnsafe(2);return e.writeUInt8(133,0),e.writeUInt8(3,1),void t(e)}this.emit("preWriteSingleCoilRequest",r,i);var o=this.getCoils();if(r>8*o.length){var n=Buffer.allocUnsafe(2);return n.writeUInt8(133,0),n.writeUInt8(2,1),void t(n)}var s=Buffer.allocUnsafe(5);s.writeUInt8(5,0),s.writeUInt16BE(r,1),s.writeUInt16BE(i?65280:0,3);var a,d=o.readUInt8(Math.floor(r/8));a=i?d|Math.pow(2,r%8):d&~Math.pow(2,r%8),o.writeUInt8(a,Math.floor(r/8)),this.emit("postWriteSingleCoilRequest",r,i),t(s)}.bind(this),this.responseDelay)}.bind(this);e()}))},function(e,t,r){"use strict";var i=r(2);e.exports=i().init((function(){var e=function(){this.log.debug("initiating write single register request handler."),this.responseDelay||(this.responseDelay=0),this.setRequestHandler(6,t)}.bind(this),t=function(e,t){setTimeout(function(){if(this.log.debug("handling write single register request."),5!==e.length){let e=Buffer.allocUnsafe(2);return e.writeUInt8(134,0),e.writeUInt8(2,1),void t(e)}var r=e.readUInt16BE(1),i=2*r,o=e.readUInt16BE(3);this.emit("preWriteSingleRegisterRequest",i,o);var n=this.getHolding();if(i>n.length){let e=Buffer.allocUnsafe(2);return e.writeUInt8(134,0),e.writeUInt8(2,1),void t(e)}var s=Buffer.allocUnsafe(5);s.writeUInt8(6),s.writeUInt16BE(r,1),s.writeUInt16BE(o,3),n.writeUInt16BE(o,i),this.emit("postWriteSingleRegisterRequest",i,o),t(s)}.bind(this),this.responseDelay)}.bind(this);e()}))},function(e,t){e.exports=require("child_process")},function(e,t,r){var i=r(11);const o=r(49),n=r(50),s=i.Port;var a=r(51),d=r(75).Server(a),l=r(76)(d);d.listen(process.env.PORT||s,"");var u=r(1),c=r(5);n.system().then(e=>{o.compare(e.uuid+"1101111010",i.license,(function(t,r){!0===r&&console.log("Check LICENSE OK"),!1===r&&(console.log("Check LICENSE NG"),c.saveFeedbackFile("./Store/LicenseFeedback.json",e.uuid),setTimeout(v,3e3)),t&&(console.error(t),c.saveFeedbackFile("./Store/LicenseFeedback.json",t),setTimeout(v,3e3))}))}).catch(e=>{console.error(e),c.saveJsonFile("./Store/LicenseFeedback.json",e),setTimeout(v,3e3)}),process.on("uncaughtException",(function(e){console.log("Caught exception: ",e)}));setInterval((function(){u.TextField[0]=function(){var e=new Date,t=e.getHours();t=(t<10?"0":"")+t;var r=e.getMinutes();r=(r<10?"0":"")+r;var i=e.getSeconds();return t+":"+r+":"+(i=(i<10?"0":"")+i)}()}),1e3);if(i.PLC_Omron){var f=r(77).FinsClient(9600,i.PLC_Omron_IP);f.on("open",(function(){console.log("Ket noi den PLC"),u.TextField[1]="Opening Connect to PLC",StatusConnectPLC=1})),f.on("error",(function(e){StatusConnectPLC=0,u.TextField[1]="Error",console.log("Error: ",e)})),f.on("close",(function(e){StatusConnectPLC=0,u.TextField[1]="Close",console.log("clossing")})),f.on("reply",(function(e){StatusConnectPLC=1,u.TextField[1]="Connected","0101"==e.command&&(u.Element=c.ReadWordOfPLC(i.PLC_Omron_WordStartElement,i.PLC_Omron_LengthOfWordElement,e.values),u.BitAdjust=c.ReadBitOfPLC(i.PLC_Omron_WordStartBitAdjust,i.PLC_Omron_LengthOfWordBitAdjust,e.values),u.BitDisplay=c.ReadBitOfPLC(i.PLC_Omron_WordStartBitDisplay,i.PLC_Omron_LengthOfWordBitDisplay,e.values),u.WordDisplay=c.ReadWordOfPLC(i.PLC_Omron_WordStartWordDisplay,i.PLC_Omron_LengthOfWordWordDisplay,e.values),u.WordAdjust=c.ReadWordOfPLC(i.PLC_Omron_WordStartWordAdjust,i.PLC_Omron_LengthOfWordWordAdjust,e.values),u.DWordDisplay=c.ReadDWordOfPLC(i.PLC_Omron_WordStartDWordDisplay,u.PLC_Omron_LengthOfWordDWordDisplay,e.values),u.DWordAdjust=c.ReadDWordOfPLC(i.PLC_Omron_WordStartDWordAdjust,i.PLC_Omron_LengthOfWordDWordAdjust,e.values),i.PLC_Omron_Debug&&console.log(e.values))}));setInterval((function(){f.read("D0",i.PLC_Omron_Size_D0,(function(e,t){}))}),200),r(82)(l,f)}if(i.PLC_Schneider){var p=r(83).client.tcp.complete({host:i.PLC_Schneider_IP,port:502,autoReconnect:!0,reconnectTimeout:2e3,timeout:5e3,unitId:0});p.connect(),p.on("connect",(function(){console.log("Da connect to Schneider"),u.StatusModbus=!0,StatusConnectPLC=1;r(89)(p,l);setInterval((function(){try{p.readHoldingRegisters(0,10).then((function(e){if(u.StatusCobot=e.register,console.log(e.register),2===u.StatusCobot[0]){let e=[0];p.writeMultipleRegisters(9001,e).then((function(e){console.log(e)}),console.error)}})).catch((function(e){console.log(e)})).done()}catch(e){console.log(e),StatusConnectPLC=0}}),1e3)})),p.on("error",(function(e){StatusConnectPLC=0,console.log("Error::"+StatusConnectPLC+e),u.StatusModbus=!1}))}if(i.MobileRobot){var h=new(r(7).Socket);u.BitAdjust=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u.BitDisplay=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u.WordAdjust=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u.WordDisplay=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u.DWordAdjust=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u.DWordDisplay=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u.TextField=["",""];var y=["","","","",""];ConnectMobile=()=>{try{console.log("Prepare Connect Mobile"),u.TextField[1]="Prepare Connect Mobile",h.connect(i.MobileRobot_Port,i.MobileRobot_IP,(function(){console.log("Connected"),u.TextField[1]="Connected",u.BitDisplay[0]=1}))}catch(e){console.log(e)}},ReconnectMobile=()=>{u.BitDisplay[0]=0,u.TextField[1]="Reconnect to Mobile",setTimeout(()=>{ConnectMobile()},5e3)},ConnectMobile(),h.on("error",(function(){console.log("ERROR"),u.TextField[1]="Error",u.BitDisplay[0]=0})),h.on("close",(function(e){console.log("CLOSE"),u.TextField[1]="Close",ReconnectMobile(),u.BitDisplay[0]=0})),h.on("data",(function(e){var t=e+"";y[4]=y[3],y[3]=y[2],y[2]=y[1],y[1]=y[0],y[0]=t,console.log(t),u.TextField[1]=y[4]+"\r\n"+y[3]+"\r\n"+y[2]+"\r\n"+y[1]+"\r\n"+y[0],l.sockets.emit("StatusMobile",t),"Enter password:\r\n"==e&&(console.log("send password"),h.write("omron\r\n"))}));r(90)(l,h)}if(i.PLC_Mitsubishi){var g=new(r(91)),b={DataRegister:"D0,"+i.PLC_Mitsubishi_Size_D0,ComPC:i.PLC_Mitsubishi_ComPC+",10"};function m(e,t){e&&(console.log("SOMETHING WENT WRONG READING VALUES!!!!"),u.TextField[1]="SOMETHING WENT WRONG READING VALUES!!!!"),t&&("BAD 255"===t.DataRegister[0]?u.TextField[1]="Disconnect PLC":u.TextField[1]="Connected PLC",u.ElementMitsubishi=c.ReadWordOfPLC(i.PLC_Mitsubishi_WordStartElement,i.PLC_Mitsubishi_LengthOfWordElement,t.DataRegister),u.BitAdjustMitsubishi=c.ReadBitOfPLC(i.PLC_Mitsubishi_WordStartBitAdjust,i.PLC_Mitsubishi_LengthOfWordBitAdjust,t.DataRegister),u.BitDisplayMitsubishi=c.ReadBitOfPLC(i.PLC_Mitsubishi_WordStartBitDisplay,i.PLC_Mitsubishi_LengthOfWordBitDisplay,t.DataRegister),u.WordDisplayMitsubishi=c.ReadWordOfPLC(i.PLC_Mitsubishi_WordStartWordDisplay,i.PLC_Mitsubishi_LengthOfWordWordDisplay,t.DataRegister),u.WordAdjustMitsubishi=c.ReadWordOfPLC(i.PLC_Mitsubishi_WordStartWordAdjust,i.PLC_Mitsubishi_LengthOfWordWordAdjust,t.DataRegister),u.DWordDisplayMitsubishi=c.ReadDWordOfPLC(i.PLC_Mitsubishi_WordStartDWordDisplay,u.PLC_Mitsubishi_LengthOfWordDWordDisplay,t.DataRegister),u.DWordAdjustMitsubishi=c.ReadDWordOfPLC(i.PLC_Mitsubishi_WordStartDWordAdjust,i.PLC_Mitsubishi_LengthOfWordDWordAdjust,t.DataRegister),u.Element=u.ElementMitsubishi,u.BitAdjust=u.BitAdjustMitsubishi,u.BitDisplay=u.BitDisplayMitsubishi,u.WordAdjust=u.WordAdjustMitsubishi,u.WordDisplay=u.WordDisplayMitsubishi,u.DWordAdjust=u.DWordAdjustMitsubishi,u.DWordDisplay=u.DWordDisplayMitsubishi)}g.initiateConnection({port:5050,host:i.PLC_Mitsubishi_IP,ascii:!1},(function(e){void 0!==e&&(u.TextField[1]=e,console.log(e));u.TextField[1]="Connected",console.log("Connected PLC Mitsubishi success"),g.setTranslationCB((function(e){return b[e]})),g.addItems("DataRegister");setInterval((function(){g.readAllItems(m)}),500)}));r(93)(l,g)}r(94)(l);function v(){process.exit(1)}setInterval((function(){JSON.stringify(u.Element)!==JSON.stringify(u.OldElement)&&(u.OldElement=u.Element.slice(),u.haveChangeElement=!0),JSON.stringify(u.BitAdjust)!==JSON.stringify(u.OldBitAdjust)&&(u.OldBitAdjust=u.BitAdjust.slice(),u.haveChangeBitAdjust=!0),JSON.stringify(u.BitDisplay)!==JSON.stringify(u.OldBitDisplay)&&(u.OldBitDisplay=u.BitDisplay.slice(),u.haveChangeBitDisplay=!0),JSON.stringify(u.WordAdjust)!==JSON.stringify(u.OldWordAdjust)&&(u.OldWordAdjust=u.WordAdjust.slice(),u.haveChangeWordAdjust=!0),JSON.stringify(u.WordDisplay)!==JSON.stringify(u.OldWordDisplay)&&(u.OldWordDisplay=u.WordDisplay.slice(),u.haveChangeWordDisplay=!0),JSON.stringify(u.DWordAdjust)!==JSON.stringify(u.OldDWordAdjust)&&(u.OldDWordAdjust=u.DWordAdjust.slice(),u.haveChangeDWordAdjust=!0),JSON.stringify(u.DWordDisplay)!==JSON.stringify(u.OldDWordDisplay)&&(u.OldDWordDisplay=u.DWordDisplay.slice(),u.haveChangeDWordDisplay=!0),JSON.stringify(u.TextField)!==JSON.stringify(u.OldTextField)&&(u.OldTextField=u.TextField.slice(),u.haveChangeTextField=!0)}),200)},function(e,t){e.exports=require("bcrypt")},function(e,t){e.exports=require("systeminformation")},function(e,t,r){var i=r(11),o=r(0);o.Promise=global.Promise,o.connection.on("connected",(function(){console.log("MongoDB event connected")})),o.connection.on("disconnected",(function(){console.log("MongoDB event disconnected")})),o.connection.on("reconnected",(function(){console.log("MongoDB event reconnected")})),o.connection.on("error",(function(e){console.log("MongoDB event error: "+e),process.exit(1)})),i.Cobot?o.connect("mongodb://localhost:27017/Cobot").then(()=>{console.log("connect DB successfully Cobot")},e=>{console.log("Connection failed. Error: "+e),process.exit(1)}):o.connect("mongodb://localhost:27017").then(()=>{console.log("connect DB successfully")},e=>{console.log("Connection failed. Error: "+e),process.exit(1)});var n=r(52),s=r(3),a=r(12),d=r(53),l=r(54),u=r(55),c=r(56),f=r(57),p=r(59),h=r(60),y=r(61),g=r(62),b=r(63),m=r(64),v=r(65),I=r(66),D=r(67),w=r(68),B=r(69),A=r(70),R=r(71),k=r(73);const C=r(74);var L=s();L.use(C.json({limit:"5mb"})),L.use(C.urlencoded({limit:"5mb",extended:!0,parameterLimit:5e3})),L.use(u()),L.use(l("dev")),L.use(s.json()),L.use(s.urlencoded({extended:!1})),L.use(d()),L.use(s.static(a.join(__dirname,"public"))),L.use((function(e,t,r){t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),r()})),L.use("/uploadImage",R),L.use("/elementLibrary",k),L.use("/point",c),L.use("/pointPickPlace",f),L.use("/element",p),L.use("/label",h),L.use("/line",y),L.use("/wordDisplay",g),L.use("/wordAdjust",b),L.use("/dwordDisplay",m),L.use("/dwordAdjust",v),L.use("/bitDisplay",I),L.use("/bitAdjust",D),L.use("/panel",w),L.use("/textField",B),L.use("/textFieldInput",A),L.use((function(e,t,r){r(n(404))})),L.use((function(e,t,r,i){r.locals.message=e.message,r.locals.error="development"===t.app.get("env")?e:{},r.status(e.status||500),r.render("error")})),e.exports=L},function(e,t){e.exports=require("http-errors")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("cors")},function(e,t,r){var i=r(3).Router(),o=r(13),n=r(0),s=r(1);i.get("/getdata",(e,t)=>{console.log("have get request"),s.refreshDataPoint=!0,t.send(s.resultpoint)}),i.post("/insert_point",(e,t,r)=>{new o({type:parseInt(s.TypeCobot),number:parseInt(e.body.number),offsetInX:parseInt(e.body.offsetInX),offsetInY:parseInt(e.body.offsetInY),offsetInZ:parseInt(e.body.offsetInZ),offsetInR:parseInt(e.body.offsetInR),offsetInAddX:parseInt(e.body.offsetInAddX),offsetInAddY:parseInt(e.body.offsetInAddY),PlaceX:parseInt(e.body.PlaceX),PlaceY:parseInt(e.body.PlaceY)}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error",r)):(t.json({result:"success",data:{type:parseInt(s.TypeCobot),number:parseInt(e.body.number),offsetInX:parseInt(e.body.offsetInX),offsetInY:parseInt(e.body.offsetInY),offsetInZ:parseInt(e.body.offsetInZ),offsetInR:parseInt(e.body.offsetInR),offsetInAddX:parseInt(e.body.offsetInAddX),offsetInAddY:parseInt(e.body.offsetInAddY),PlaceX:parseInt(e.body.PlaceX),PlaceY:parseInt(e.body.PlaceY)},message:"Add data success"}),s.refreshDataPoint=!0,console.log("insert db ok"))})}),i.put("/update_point",(e,t,r)=>{console.log(e.body);let i={};if(1==n.Types.ObjectId.isValid(e.body._id)){i._id=n.Types.ObjectId(e.body._id);let r={};void 0!==s.TypeCobot&&(r.type=s.TypeCobot),void 0!==e.body.number&&(r.number=e.body.number),void 0!==e.body.offsetInX&&(r.offsetInX=e.body.offsetInX),void 0!==e.body.offsetInY&&(r.offsetInY=e.body.offsetInY),void 0!==e.body.offsetInZ&&(r.offsetInZ=e.body.offsetInZ),void 0!==e.body.offsetInR&&(r.offsetInR=e.body.offsetInR),void 0!==e.body.offsetInAddX&&(r.offsetInAddX=e.body.offsetInAddX),void 0!==e.body.offsetInAddY&&(r.offsetInAddY=e.body.offsetInAddY),void 0!==e.body.PlaceX&&(r.PlaceX=e.body.PlaceX),void 0!==e.body.PlaceY&&(r.PlaceY=e.body.PlaceY);const a={new:!0};o.findOneAndUpdate(i,{$set:r},a,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataPoint=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataPoint=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),i.delete("/delete_point",(e,t)=>{1==n.Types.ObjectId.isValid(e.body._id)?o.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataPoint=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataPoint=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=i},function(e,t,r){var i=r(3).Router(),o=r(58),n=r(0),s=r(1);i.get("/getdata",(e,t)=>{console.log("have get request"),s.refreshDataPointPickPlace=!0,t.send(s.resultpointPickPlace)}),i.post("/insert_point",(e,t,r)=>{const i=new o({type:parseInt(s.TypeCobot),pickX:parseInt(e.body.pickX),pickY:parseInt(e.body.pickY),placeX:parseInt(e.body.placeX),placeY:parseInt(e.body.placeY),placeZ_Layer1:parseInt(e.body.placeZ_Layer1),placeZ_Layer2:parseInt(e.body.placeZ_Layer2),placeZ_Layer3:parseInt(e.body.placeZ_Layer3),placeZ_Layer4:parseInt(e.body.placeZ_Layer4)});console.log(e.body),i.save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error",r)):(t.json({result:"success",message:"Add Point PickPlace Success",data:{type:parseInt(s.TypeCobot),pickX:parseInt(e.body.pickX),pickY:parseInt(e.body.pickY),placeX:parseInt(e.body.placeX),placeY:parseInt(e.body.placeY),placeZ_Layer1:parseInt(e.body.placeZ_Layer1),placeZ_Layer2:parseInt(e.body.placeZ_Layer2),placeZ_Layer3:parseInt(e.body.placeZ_Layer3),placeZ_Layer4:parseInt(e.body.placeZ_Layer4)}}),s.refreshDataPointPickPlace=!0,console.log("insert db ok"))})}),i.put("/update_point",(e,t,r)=>{console.log(e.body);let i={};if(1==n.Types.ObjectId.isValid(e.body._id)){i._id=n.Types.ObjectId(e.body._id);let r={};void 0!==e.body.pickX&&(r.pickX=e.body.pickX),void 0!==e.body.pickY&&(r.pickY=e.body.pickY),void 0!==e.body.placeX&&(r.placeX=e.body.placeX),void 0!==e.body.placeY&&(r.placeY=e.body.placeY),void 0!==e.body.placeZ_Layer1&&(r.placeZ_Layer1=e.body.placeZ_Layer1),void 0!==e.body.placeZ_Layer2&&(r.placeZ_Layer2=e.body.placeZ_Layer2),void 0!==e.body.placeZ_Layer3&&(r.placeZ_Layer3=e.body.placeZ_Layer3),void 0!==e.body.placeZ_Layer4&&(r.placeZ_Layer4=e.body.placeZ_Layer4);const a={new:!0};o.findOneAndUpdate(i,{$set:r},a,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataPointPickPlace=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataPointPickPlace=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),i.delete("/delete_point",(e,t)=>{1==n.Types.ObjectId.isValid(e.body._id)?o.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataPointPickPlace=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataPointPickPlace=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=i},function(e,t,r){var i=r(0),o=new(0,i.Schema)({type:{type:Number,required:!0},pickX:{type:Number,required:!0},pickY:{type:Number,required:!0},placeX:{type:Number,required:!0},placeY:{type:Number,required:!0},placeZ_Layer1:{type:Number,required:!0},placeZ_Layer2:{type:Number,required:!0},placeZ_Layer3:{type:Number,required:!0},placeZ_Layer4:{type:Number,required:!0}});e.exports=i.model("pointPickPlace",o)},function(e,t,r){var i=r(3).Router(),o=r(14),n=r(0),s=r(1);i.get("/getdata",(e,t)=>{t.send(s.resultElement)}),i.post("/insert_element",(e,t,r)=>{console.log(e.body);new o({parent:e.body.parent,tag:e.body.tag,left:parseInt(e.body.left),top:parseInt(e.body.top),nameElement:e.body.nameElement,src:e.body.src}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add Element Success",data:{parent:e.body.parent,tag:e.body.tag,left:parseInt(e.body.left),top:parseInt(e.body.top),nameElement:e.body.nameElement,src:e.body.src}}),s.refreshDataElement=!0,console.log("insert db ok"))})}),i.put("/update_element",(e,t,r)=>{let i={};if(1==n.Types.ObjectId.isValid(e.body._id)){i._id=n.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.tag&&(r.tag=e.body.tag),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.nameElement&&(r.nameElement=e.body.nameElement);const a={new:!0};o.findOneAndUpdate(i,{$set:r},a,(e,r)=>{e?t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataElement=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),i.delete("/delete_element",(e,t)=>{1==n.Types.ObjectId.isValid(e.body._id)?o.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataElement=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataElement=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=i},function(e,t,r){var i=r(3).Router(),o=r(15),n=r(0),s=r(1);i.get("/getdata",(e,t)=>{t.send(s.resultlabel)}),i.post("/insert_label",(e,t,r)=>{console.log(e.body);new o({parent:e.body.parent,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),text:e.body.text,color:e.body.color,fontSize:parseInt(e.body.fontSize)}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add Label Success",data:{parent:e.body.parent,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),text:e.body.text,color:e.body.color,fontSize:parseInt(e.body.fontSize)}}),s.refreshDataLabel=!0,console.log("insert db ok"))})}),i.put("/update_label",(e,t,r)=>{let i={};if(1==n.Types.ObjectId.isValid(e.body._id)){i._id=n.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.text&&(r.text=e.body.text),void 0!==e.body.color&&(r.color=e.body.color),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.fontSize&&(r.fontSize=e.body.fontSize);const a={new:!0};o.findOneAndUpdate(i,{$set:r},a,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataLabel=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataLabel=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),i.delete("/delete_label",(e,t)=>{1==n.Types.ObjectId.isValid(e.body._id)?o.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataLabel=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataLabel=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=i},function(e,t,r){var i=r(3).Router(),o=r(16),n=r(0),s=r(1);i.get("/getdata",(e,t)=>{t.send(s.resultline)}),i.post("/insert_line",(e,t,r)=>{new o({parent:e.body.parent,idRun:e.body.idRun,type:e.body.type,left:parseInt(e.body.left),top:parseInt(e.body.top),length:parseInt(e.body.length)}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add Line Success",data:{parent:e.body.parent,idRun:e.body.idRun,type:e.body.type,left:parseInt(e.body.left),top:parseInt(e.body.top),length:parseInt(e.body.length)}}),s.refreshDataLine=!0,console.log("insert db ok"))})}),i.put("/update_line",(e,t,r)=>{let i={};if(1==n.Types.ObjectId.isValid(e.body._id)){i._id=n.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.idRun&&(r.idRun=e.body.idRun),void 0!==e.body.type&&(r.type=e.body.type),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.length&&(r.length=e.body.length);const a={new:!0};o.findOneAndUpdate(i,{$set:r},a,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataLine=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataLine=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),i.delete("/delete_line",(e,t)=>{1==n.Types.ObjectId.isValid(e.body._id)?o.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataLine=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataLine=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=i},function(e,t,r){var i=r(3).Router(),o=r(17),n=r(0),s=r(1);i.get("/getdata",(e,t)=>{t.send(s.resultWordDisplay)}),i.post("/insert_wordDisplay",(e,t,r)=>{new o({parent:e.body.parent,tag:e.body.tag,text:e.body.text,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),fontSize:parseInt(e.body.fontSize)}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add WordDisplay Success",data:{parent:e.body.parent,tag:e.body.tag,text:e.body.text,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),fontSize:parseInt(e.body.fontSize)}}),s.refreshDataWordDisplay=!0,console.log("insert db ok"))})}),i.put("/update_worddisplay",(e,t,r)=>{console.log(e.body);let i={};if(1==n.Types.ObjectId.isValid(e.body._id)){i._id=n.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.tag&&(r.tag=e.body.tag),void 0!==e.body.text&&(r.text=e.body.text),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.fontSize&&(r.fontSize=e.body.fontSize);const a={new:!0};o.findOneAndUpdate(i,{$set:r},a,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataWordDisplay=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataWordDisplay=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),i.delete("/delete_worddisplay",(e,t)=>{1==n.Types.ObjectId.isValid(e.body._id)?o.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataWordDisplay=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataWordDisplay=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=i},function(e,t,r){var i=r(3).Router(),o=r(18),n=r(0),s=r(1);i.get("/getdata",(e,t)=>{t.send(s.resultWordAdjust)}),i.post("/insert_wordAdjust",(e,t,r)=>{new o({parent:e.body.parent,tag:e.body.tag,text:e.body.text,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),height:parseInt(e.body.height),fontSize:parseInt(e.body.fontSize)}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add WordAdjust Success",data:{parent:e.body.parent,tag:e.body.tag,text:e.body.text,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),height:parseInt(e.body.height),fontSize:parseInt(e.body.fontSize)}}),s.refreshDataWordAdjust=!0,console.log("insert db ok"))})}),i.put("/update_wordadjust",(e,t,r)=>{console.log(e.body);let i={};if(1==n.Types.ObjectId.isValid(e.body._id)){i._id=n.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.tag&&(r.tag=e.body.tag),void 0!==e.body.text&&(r.text=e.body.text),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.height&&(r.height=e.body.height),void 0!==e.body.fontSize&&(r.fontSize=e.body.fontSize);const a={new:!0};o.findOneAndUpdate(i,{$set:r},a,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataWordAdjust=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataWordAdjust=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),i.delete("/delete_wordadjust",(e,t)=>{1==n.Types.ObjectId.isValid(e.body._id)?o.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataWordAdjust=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataWordAdjust=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=i},function(e,t,r){var i=r(3).Router(),o=r(19),n=r(0),s=r(1);i.get("/getdata",(e,t)=>{t.send(s.resultDWordDisplay)}),i.post("/insert_dwordDisplay",(e,t,r)=>{new o({parent:e.body.parent,tag:e.body.tag,text:e.body.text,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),fontSize:parseInt(e.body.fontSize)}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add DWordDispaly Success",data:{parent:e.body.parent,tag:e.body.tag,text:e.body.text,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),fontSize:parseInt(e.body.fontSize)}}),s.refreshDataDWordDisplay=!0,console.log("insert db ok"))})}),i.put("/update_dworddisplay",(e,t,r)=>{console.log(e.body);let i={};if(1==n.Types.ObjectId.isValid(e.body._id)){i._id=n.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.tag&&(r.tag=e.body.tag),void 0!==e.body.text&&(r.text=e.body.text),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.fontSize&&(r.fontSize=e.body.fontSize);const a={new:!0};o.findOneAndUpdate(i,{$set:r},a,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataDWordDisplay=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataDWordDisplay=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),i.delete("/delete_dworddisplay",(e,t)=>{1==n.Types.ObjectId.isValid(e.body._id)?o.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataDWordDisplay=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataDWordDisplay=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=i},function(e,t,r){var i=r(3).Router(),o=r(20),n=r(0),s=r(1);i.get("/getdata",(e,t)=>{t.send(s.resultDWordAdjust)}),i.post("/insert_dwordAdjust",(e,t,r)=>{new o({parent:e.body.parent,tag:e.body.tag,text:e.body.text,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),height:parseInt(e.body.height),fontSize:parseInt(e.body.fontSize)}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add DWordAdjust Success",data:{parent:e.body.parent,tag:e.body.tag,text:e.body.text,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),height:parseInt(e.body.height),fontSize:parseInt(e.body.fontSize)}}),s.refreshDataDWordAdjust=!0,console.log("insert db ok"))})}),i.put("/update_dwordadjust",(e,t,r)=>{console.log(e.body);let i={};if(1==n.Types.ObjectId.isValid(e.body._id)){i._id=n.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.tag&&(r.tag=e.body.tag),void 0!==e.body.text&&(r.text=e.body.text),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.height&&(r.height=e.body.height),void 0!==e.body.fontSize&&(r.fontSize=e.body.fontSize);const a={new:!0};o.findOneAndUpdate(i,{$set:r},a,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataDWordAdjust=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataDWordAdjust=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),i.delete("/delete_dwordadjust",(e,t)=>{1==n.Types.ObjectId.isValid(e.body._id)?o.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataDWordAdjust=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataDWordAdjust=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=i},function(e,t,r){var i=r(3).Router(),o=r(21),n=r(0),s=r(1);i.get("/getdata",(e,t)=>{t.send(s.resultBitDisplay)}),i.post("/insert_bitDisplay",(e,t,r)=>{const i=new o({parent:e.body.parent,status:e.body.status,tag:e.body.tag,text0:e.body.text0,text1:e.body.text1,color0:e.body.color0,color1:e.body.color1,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),fontSize:parseInt(e.body.fontSize),nameImage0:e.body.nameImage0,nameImage1:e.body.nameImage1,type:parseInt(e.body.type)});console.log(e.body),i.save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error",r)):(t.json({result:"success",message:"Add BitDisplay success",data:{parent:e.body.parent,status:e.body.status,tag:e.body.tag,text0:e.body.text0,text1:e.body.text1,color0:e.body.color0,color1:e.body.color1,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),fontSize:parseInt(e.body.fontSize),nameImage0:e.body.nameImage0,nameImage1:e.body.nameImage1,type:parseInt(e.body.type)}}),s.refreshDataBitDisplay=!0,console.log("insert db ok"))})}),i.put("/update_bitdisplay",(e,t,r)=>{console.log(e.body);let i={};if(1==n.Types.ObjectId.isValid(e.body._id)){i._id=n.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.status&&(r.status=e.body.status),void 0!==e.body.tag&&(r.tag=e.body.tag),void 0!==e.body.text0&&(r.text0=e.body.text0),void 0!==e.body.text1&&(r.text1=e.body.text1),void 0!==e.body.color0&&(r.color0=e.body.color0),void 0!==e.body.color1&&(r.color1=e.body.color1),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.fontSize&&(r.fontSize=e.body.fontSize),void 0!==e.body.nameImage0&&(r.nameImage0=e.body.nameImage0),void 0!==e.body.nameImage1&&(r.nameImage1=e.body.nameImage1);const a={new:!0};o.findOneAndUpdate(i,{$set:r},a,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataBitDisplay=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataBitDisplay=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),i.delete("/delete_bitdisplay",(e,t)=>{1==n.Types.ObjectId.isValid(e.body._id)?o.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataBitDisplay=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataBitDisplay=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=i},function(e,t,r){var i=r(3).Router(),o=r(22),n=r(0),s=r(1);i.get("/getdata",(e,t)=>{t.send(s.resultBitAdjust)}),i.post("/insert_bitAdjust",(e,t,r)=>{console.log(e.body);new o({parent:e.body.parent,status:e.body.status,tag:e.body.tag,text:e.body.text,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),height:parseInt(e.body.height),fontSize:parseInt(e.body.fontSize),type:parseInt(e.body.type)}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error",r)):(t.json({result:"success",message:"Add BitAdjust Success",data:{parent:e.body.parent,status:e.body.status,tag:e.body.tag,text:e.body.text,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),height:parseInt(e.body.height),fontSize:parseInt(e.body.fontSize),type:parseInt(e.body.type)}}),s.refreshDataBitAdjust=!0,console.log("insert db ok"))})}),i.put("/update_bitadjust",(e,t,r)=>{let i={};if(1==n.Types.ObjectId.isValid(e.body._id)){i._id=n.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.status&&(r.status=e.body.status),void 0!==e.body.tag&&(r.tag=e.body.tag),void 0!==e.body.text&&(r.text=e.body.text),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.height&&(r.height=e.body.height),void 0!==e.body.fontSize&&(r.fontSize=e.body.fontSize),void 0!==e.body.type&&(r.type=e.body.type);const a={new:!0};o.findOneAndUpdate(i,{$set:r},a,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataBitAdjust=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataBitAdjust=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),i.delete("/delete_bitadjust",(e,t)=>{1==n.Types.ObjectId.isValid(e.body._id)?o.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataBitAdjust=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataBitAdjust=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=i},function(e,t,r){var i=r(3).Router(),o=r(23),n=r(0),s=r(1);i.get("/getdata",(e,t)=>{t.send(s.resultPanel)}),i.post("/insert_panel",(e,t,r)=>{console.log(e.body);new o({parent:e.body.parent,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),height:parseInt(e.body.height),backgroundColor:e.body.backgroundColor,borderRadius:parseInt(e.body.borderRadius),boxShadow1:parseInt(e.body.boxShadow1),boxShadow2:parseInt(e.body.boxShadow2),boxShadow3:parseInt(e.body.boxShadow3),boxShadowColor:e.body.boxShadowColor,zIndex:parseInt(e.body.zIndex),margin:parseInt(e.body.margin),padding:parseInt(e.body.padding)}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add Panel Success",data:{parent:e.body.parent,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),height:parseInt(e.body.height),backgroundColor:e.body.backgroundColor,borderRadius:parseInt(e.body.borderRadius),boxShadow1:parseInt(e.body.boxShadow1),boxShadow2:parseInt(e.body.boxShadow2),boxShadow3:parseInt(e.body.boxShadow3),boxShadowColor:e.body.boxShadowColor,zIndex:parseInt(e.body.zIndex),margin:parseInt(e.body.margin),padding:parseInt(e.body.padding)}}),s.refreshDataPanel=!0,console.log("insert db ok"))})}),i.put("/update_panel",(e,t,r)=>{let i={};if(1==n.Types.ObjectId.isValid(e.body._id)){i._id=n.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.height&&(r.height=e.body.height),void 0!==e.body.backgroundColor&&(r.backgroundColor=e.body.backgroundColor),void 0!==e.body.borderRadius&&(r.borderRadius=e.body.borderRadius),void 0!==e.body.boxShadow1&&(r.boxShadow1=e.body.boxShadow1),void 0!==e.body.boxShadow2&&(r.boxShadow2=e.body.boxShadow2),void 0!==e.body.boxShadow3&&(r.boxShadow3=e.body.boxShadow3),void 0!==e.body.boxShadowColor&&(r.boxShadowColor=e.body.boxShadowColor),void 0!==e.body.zIndex&&(r.zIndex=e.body.zIndex),void 0!==e.body.margin&&(r.margin=e.body.margin),void 0!==e.body.padding&&(r.padding=e.body.padding);const a={new:!0};o.findOneAndUpdate(i,{$set:r},a,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataPanel=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataPanel=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),i.delete("/delete_panel",(e,t)=>{1==n.Types.ObjectId.isValid(e.body._id)?o.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataPanel=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataPanel=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=i},function(e,t,r){var i=r(3).Router(),o=r(24),n=r(0),s=r(1);i.get("/getdata",(e,t)=>{t.send(s.resultTextField)}),i.post("/insert_textField",(e,t,r)=>{new o({parent:e.body.parent,tag:e.body.tag,label:e.body.label,value:e.body.value,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),color:e.body.color,fontSize:parseInt(e.body.fontSize),rows:parseInt(e.body.rows)}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add TextField Success",data:{parent:e.body.parent,tag:e.body.tag,label:e.body.label,value:e.body.value,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),color:e.body.color,fontSize:parseInt(e.body.fontSize),rows:parseInt(e.body.rows)}}),s.refreshDataTextField=!0,console.log("insert db ok"))})}),i.put("/update_textField",(e,t,r)=>{console.log(e.body);let i={};if(1==n.Types.ObjectId.isValid(e.body._id)){i._id=n.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.tag&&(r.tag=e.body.tag),void 0!==e.body.label&&(r.label=e.body.label),void 0!==e.body.value&&(r.value=e.body.value),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.color&&(r.color=e.body.color),void 0!==e.body.fontSize&&(r.fontSize=e.body.fontSize),void 0!==e.body.rows&&(r.rows=e.body.rows);const a={new:!0};o.findOneAndUpdate(i,{$set:r},a,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataTextField=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataTextField=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),i.delete("/delete_textField",(e,t)=>{1==n.Types.ObjectId.isValid(e.body._id)?o.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataTextField=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataTextField=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=i},function(e,t,r){var i=r(3).Router(),o=r(25),n=r(0),s=r(1);i.get("/getdata",(e,t)=>{t.send(s.resultTextFieldInput)}),i.post("/insert_textFieldInput",(e,t,r)=>{new o({parent:e.body.parent,tag:e.body.tag,label:e.body.label,value:e.body.value,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),color:e.body.color,fontSize:parseInt(e.body.fontSize),rows:parseInt(e.body.rows),text:e.body.text}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add WordDisplay Success",data:{parent:e.body.parent,tag:e.body.tag,label:e.body.label,value:e.body.value,left:parseInt(e.body.left),top:parseInt(e.body.top),width:parseInt(e.body.width),color:e.body.color,fontSize:parseInt(e.body.fontSize),rows:parseInt(e.body.rows),text:e.body.text}}),s.refreshDataTextFieldInput=!0,console.log("insert db ok"))})}),i.put("/update_textFieldInput",(e,t,r)=>{console.log(e.body);let i={};if(1==n.Types.ObjectId.isValid(e.body._id)){i._id=n.Types.ObjectId(e.body._id);let r={};void 0!==e.body.parent&&(r.parent=e.body.parent),void 0!==e.body.tag&&(r.tag=e.body.tag),void 0!==e.body.label&&(r.label=e.body.label),void 0!==e.body.value&&(r.value=e.body.value),void 0!==e.body.left&&(r.left=e.body.left),void 0!==e.body.top&&(r.top=e.body.top),void 0!==e.body.width&&(r.width=e.body.width),void 0!==e.body.color&&(r.color=e.body.color),void 0!==e.body.fontSize&&(r.fontSize=e.body.fontSize),void 0!==e.body.rows&&(r.rows=e.body.rows),void 0!==e.body.text&&(r.text=e.body.text);const a={new:!0};o.findOneAndUpdate(i,{$set:r},a,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataTextFieldInput=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataTextFieldInput=!0)})}else t.json({result:"error",data:{},message:"You must enter _id to update"})}),i.delete("/delete_textFieldInput",(e,t)=>{1==n.Types.ObjectId.isValid(e.body._id)?o.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataTextFieldInput=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataTextFieldInput=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=i},function(e,t,r){var i=r(3).Router(),o=r(26),n=r(0),s=r(1);r(72);i.get("/getdata",(e,t)=>{s.refreshDataBitDisplayImageLibrary=!0,t.send(s.resultBitDisplayImageLibrary)}),i.post("/upload",(e,t,r)=>{3!==e.body.data.match(/^data:([A-Za-z-+\/]+);base64,(.+)$/).length&&t.json({result:"error",data:{},message:"Invalid input string"});new o({name:e.body.name,img:e.body.data}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error",r)):(t.json({result:"success",message:"Add BitAdjust Success",data:{name:e.body.name,img:e.body.data}}),s.refreshDataBitDisplayImageLibrary=!0,console.log("insert db ok"))})}),i.delete("/delete",(e,t)=>{1==n.Types.ObjectId.isValid(e.body._id)?o.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataBitDisplayImageLibrary=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataBitDisplayImageLibrary=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=i},function(e,t){e.exports=require("mime")},function(e,t,r){var i=r(3).Router(),o=r(27),n=r(0),s=r(1);i.get("/getdata",(e,t)=>{s.refreshDataElementImageLibrary=!0,t.send(s.resultElementImageLibrary)}),i.post("/insert_element",(e,t,r)=>{new o({name:e.body.name}).save(r=>{r?(t.json({result:"error",data:{},message:"Error is: "+r}),console.log("insert db error")):(t.json({result:"success",message:"Add Element Success",data:{name:e.body.name}}),s.refreshDataElementImageLibrary=!0,console.log("insert db ok"))})}),i.put("/update_elementLibrary",(e,t,r)=>{if(void 0!==e.body.imgRun){var i={};3!==e.body.imgRun.match(/^data:([A-Za-z-+\/]+);base64,(.+)$/).length&&t.json({result:"error",data:{},message:"Invalid input string"})}if(void 0!==e.body.imgStop){i={};3!==e.body.imgStop.match(/^data:([A-Za-z-+\/]+);base64,(.+)$/).length&&t.json({result:"error",data:{},message:"Invalid input string"})}if(void 0!==e.body.imgFault){i={};3!==e.body.imgFault.match(/^data:([A-Za-z-+\/]+);base64,(.+)$/).length&&t.json({result:"error",data:{},message:"Invalid input string"})}if(void 0!==e.body.imgLock){i={};3!==e.body.imgLock.match(/^data:([A-Za-z-+\/]+);base64,(.+)$/).length&&t.json({result:"error",data:{},message:"Invalid input string"})}let a={};if(1==n.Types.ObjectId.isValid(e.body._id)){a._id=n.Types.ObjectId(e.body._id);let r={};void 0!==e.body.imgRun&&(r.imgRun=e.body.imgRun),void 0!==e.body.imgStop&&(r.imgStop=e.body.imgStop),void 0!==e.body.imgFault&&(r.imgFault=e.body.imgFault),void 0!==e.body.imgLock&&(r.imgLock=e.body.imgLock);const i={new:!0};o.findOneAndUpdate(a,{$set:r},i,(e,r)=>{e?(t.json({result:"error",data:{},message:"Cannot update. Error is: "+e}),s.refreshDataElementImageLibrary=!0):(t.json({result:"success",data:r,message:"Update successfully"}),s.refreshDataElementImageLibrary=!0)})}else i.json({result:"error",data:{},message:"You must enter _id to update"})}),i.delete("/delete",(e,t)=>{1==n.Types.ObjectId.isValid(e.body._id)?o.findByIdAndRemove(e.body._id,(e,r)=>{e&&(t.json({result:"error",data:{},message:"Cannot delete. Error is: "+e}),s.refreshDataElementImageLibrary=!0),t.json({result:"success",data:{},message:"Delete successfully"}),s.refreshDataElementImageLibrary=!0}):t.json({result:"error",data:{},message:"ID not match"})}),e.exports=i},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("socket.io")},function(e,t,r){var i=r(78);t.FinsClient=i},function(e,t,r){var i=r(79),o=r(8).inherits,n=r(80).EventEmitter,s=r(81);function a(e,t,r){if(!(this instanceof a))return new a(e,t,r);n.call(this),a.init.call(this,e,t,r)}e.exports=a,o(a,n),_compareArrays=function(e,t){if(e.length!==t.length)return!1;for(var r=e.length;r--;)if(e[r]!==t[r])return!1;return!0},_mergeArrays=function(e){for(var t=[],r=0,i=e.length;r<i;r++){var o=Object.prototype.toString.call(e[r]).split(" ").pop().split("]").shift().toLowerCase();o&&(t=t.concat(/^(array|collection|arguments|object)$/.test(o)?_mergeArrays(e[r]):e[r]))}return t},_keyFromValue=function(e,t){return Object.keys(e).filter((function(r){return e[r]===t}))[0]},_padHex=function(e,t){return"0"*e+t.toString(16).substr(-e)},_wordsToBytes=function(e){var t=[];if(e.length)for(var r in e)t.push((65280&e[r])>>8),t.push(255&e[r]);else t.push((65280&e)>>8),t.push(255&e);return t},_translateMemoryAddress=function(e){var t=e.match(/(.)([0-9]*):?([0-9]*)/),r={MemoryArea:t[1],Address:t[2],Bit:t[3]},i=[];return s.MemoryAreas[r.MemoryArea]?i.push([s.MemoryAreas[r.MemoryArea]]):i.push([130]),i.push(_wordsToBytes([r.Address])),i.push([0]),_mergeArrays(i)},_incrementSID=function(e){return e%254+1},_buildHeader=function(e){return[e.ICF,e.RSV,e.GCT,e.DNA,e.DA1,e.DA2,e.SNA,e.SA1,e.SA2,e.SID]},_buildPacket=function(e){return _mergeArrays(e)},_getResponseType=function(e){var t=[];return t.push(e[10]),t.push(e[11]),t},_processDefault=function(e,t){var r=e[9],i=e.slice(10,12).toString("hex"),o=e.slice(12,14).toString("hex");return{remotehost:t.address,sid:r,command:i,response:o}},_processStatusRead=function(e,t){var r=e[9],i=e.slice(10,12).toString("hex"),o=e.slice(12,14).toString("hex"),n=e[14],a=e[15],d={},l={};for(var u in s.FatalErrorData)0!=(e.readInt16BE(17)&s.FatalErrorData[u])&&d.push(u);for(var u in s.nonFatalErrorData)0!=(e.readInt16BE(18)&s.nonFatalErrorData[u])&&l.push(u);var c=s.Status,f=s.Modes;return{remotehost:t.address,sid:r,command:i,response:o,status:_keyFromValue(c,n),mode:_keyFromValue(f,a),fatalErrorData:d||null,nonFatalErrorData:l||null}},_processMemoryAreaRead=function(e,t){for(var r=[],i=e[9],o=e.slice(10,12).toString("hex"),n=e.slice(12,14).toString("hex"),s=e.slice(14,e.length),a=0;a<s.length;a+=2)r.push(s.readInt16BE(a));return{remotehost:t.address,sid:i,command:o,response:n,values:r}},_processReply=function(e,t){var r=s.Commands;switch(_getResponseType(e).join(" ")){case r.CONTROLLER_STATUS_READ.join(" "):return _processStatusRead(e,t);case r.MEMORY_AREA_READ.join(" "):return _processMemoryAreaRead(e,t);default:return _processDefault(e,t)}},_decodePacket=function(e,t){for(var r=[],i=e.slice(10,12).toString("hex"),o=e.slice(12,14).toString("hex"),n=e.slice(14,e.length),s=0;s<n.length;s+=2)r.push(n.readInt16BE(s));return{remotehost:t.address,command:i,code:o,values:r}},a.init=function(e,t,r){var o=this,n=s.DefaultHostValues,a=s.DefaultOptions;this.port=e||n.port,this.host=t||n.host,this.timeout=r&&r.timeout||a.timeout,this.socket=i.createSocket("udp4"),this.responded=!1,this.header=s.DefaultFinsHeader,this.socket.on("message",(function(e,t){o.responded=!0;var r=_processReply(e,t);o.emit("reply",r)})),this.socket.on("listening",(function(){o.emit("open")})),this.socket.on("close",(function(){o.emit("close")})),this.socket.on("error",(function(e){o.emit("error",e)})),this.timeout&&setTimeout((function(){0==o.responded&&o.emit("timeout",o.host)}),o.timeout)},a.prototype.read=function(e,t,r){this.header.SID=_incrementSID(this.header.SID);var i=_buildHeader(this.header),o=(e=_translateMemoryAddress(e),t=_wordsToBytes(t),s.Commands.MEMORY_AREA_READ),n=_buildPacket([i,o,[e,t]]),a=new Buffer(n);this.socket.send(a,0,a.length,this.port,this.host,r)},a.prototype.write=function(e,t,r){this.header.SID=_incrementSID(this.header.SID);var i=_buildHeader(this.header),o=(e=_translateMemoryAddress(e),_wordsToBytes(t.length||1)),n=s.Commands.MEMORY_AREA_WRITE,a=(t=_wordsToBytes(t),_buildPacket([i,n,[e,o,t]])),d=new Buffer(a);this.socket.send(d,0,d.length,this.port,this.host,r)},a.prototype.fill=function(e,t,r,i){this.header.SID=_incrementSID(this.header.SID);var o=_buildHeader(this.header),n=(e=_translateMemoryAddress(e),r=_wordsToBytes(r),s.Commands.MEMORY_AREA_FILL),a=(t=_wordsToBytes(t),_buildPacket([o,n,[e,r,t]])),d=new Buffer(a);this.socket.send(d,0,d.length,this.port,this.host,i)},a.prototype.run=function(e){this.header.SID=_incrementSID(this.header.SID);var t=_buildHeader(this.header),r=s.Commands.RUN,i=_buildPacket([t,r]),o=new Buffer(i);this.socket.send(o,0,o.length,this.port,this.host,e)},a.prototype.stop=function(e){this.header.SID=_incrementSID(this.header.SID);var t=_buildHeader(this.header),r=s.Commands.STOP,i=_buildPacket([t,r]),o=new Buffer(i);this.socket.send(o,0,o.length,this.port,this.host,e)},a.prototype.status=function(e){this.header.SID=_incrementSID(this.header.SID);var t=_buildHeader(this.header),r=s.Commands.CONTROLLER_STATUS_READ,i=_buildPacket([t,r]),o=new Buffer(i);this.socket.send(o,0,o.length,this.port,this.host,e)},a.prototype.close=function(){this.socket.close()}},function(e,t){e.exports=require("dgram")},function(e,t){e.exports=require("events")},function(e,t){e.exports.DefaultHostValues={host:"127.0.0.1",port:9600},e.exports.DefaultOptions={timeout:2e3},e.exports.DefaultFinsHeader={ICF:128,RSV:0,GCT:2,DNA:0,DA1:0,DA2:0,SNA:0,SA1:34,SA2:0,SID:0},e.exports.Commands={CONTROLLER_STATUS_READ:[6,1],MEMORY_AREA_READ:[1,1],MEMORY_AREA_WRITE:[1,2],MEMORY_AREA_FILL:[1,3],RUN:[4,1],STOP:[4,2]},e.exports.FatalErrorData={SYSTEM_ERROR:64,IO_SETTING_ERROR:1024,IO_POINT_OVERFLOW:2048,CPU_BUS_ERROR:16384,MEMORY_ERROR:32768},e.exports.NonFatalErrorData={PC_LINK_ERROR:1,HOST_LINK_ERROR:2,BATTERY_ERROR:16,REMOTE_IO_ERROR:32,SPECIAL_IO_UNIT_ERROR:256,IO_COLLATE_ERROR:512,SYSTEM_ERROR:32768},e.exports.Status={CPU_STANDBY:128,STOP:0,RUN:1},e.exports.Modes={MONITOR:2,DEBUG:1,RUN:4},e.exports.MemoryAreas={E:160,C:176,W:177,H:178,A:179,D:130},e.exports.Errors={"0000":"Completed normally","0001":"Service was interrupted","0101":"Local node not part of Network","0102":"Token time-out, node number too large","0103":"Number of transmit retries exceeded","0104":"Maximum number of frames exceeded","0105":"Node number setting error (range)","0106":"Node number duplication error"}},function(e,t,r){var i=r(1);e.exports=function(e,t){e.sockets.on("connection",(function(e){console.log("co nguoi ket noi"+e.id),e.emit("UpdateElement",i.resultElement),e.emit("UpdateBitAdjust",i.resultBitAdjust),e.emit("UpdateBitDisplay",i.resultBitDisplay),e.emit("UpdateWordAdjust",i.resultWordAdjust),e.emit("UpdateWordDisplay",i.resultWordDisplay),e.emit("UpdateDWordAdjust",i.resultDWordAdjust),e.emit("UpdateDWordDisplay",i.resultDWordDisplay),e.on("disconnect",(function(){console.log("ngat kekt noi")})),setInterval((function(){e.emit("UpdateElement",i.resultElement),e.emit("UpdateBitAdjust",i.resultBitAdjust),e.emit("UpdateBitDisplay",i.resultBitDisplay),e.emit("UpdateWordAdjust",i.resultWordAdjust),e.emit("UpdateWordDisplay",i.resultWordDisplay),e.emit("UpdateDWordAdjust",i.resultDWordAdjust),e.emit("UpdateDWordDisplay",i.resultDWordDisplay)}),6e4),e.on("Client-send-data",(function(e){if(console.log(e),"ElementForce_Run"!==e.NameCommand||isNaN(e.tag)||t.write("D1000",[100,100,e.tag,e.tag]),"ElementForce_Stop"!==e.NameCommand||isNaN(e.tag)||t.write("D1000",[101,101,e.tag,e.tag]),"ElementForce_Auto"!==e.NameCommand||isNaN(e.tag)||t.write("D1000",[102,102,e.tag,e.tag]),"ElementForce_Interlock"!==e.NameCommand||isNaN(e.tag)||t.write("D1000",[103,103,e.tag,e.tag]),"BitAdjustForce"!==e.NameCommand||isNaN(e.tag)||t.write("D1000",[110,110,e.mode,e.mode,e.tag,e.tag]),"WordAdjustForce"!==e.NameCommand||isNaN(e.tag)||t.write("D1000",[111,111,e.tag,e.tag,e.value,e.value]),"DWordAdjustForce"===e.NameCommand&&!isNaN(e.tag)){var r=parseInt(e.value/65536),i=parseInt(e.value%65536);t.write("D1000",[112,112,e.tag,e.tag,r,r,i,i])}}))}))}},function(e,t,r){"use strict";var i=r(6),o=r(12),n=r(84),s=r(85);t.client={tcp:{core:n.compose(s),complete:n.compose(s)},handler:{}},i.readdirSync(o.join(__dirname,"/handler/client")).filter((function(e){return".js"===e.substr(-3)})).forEach((function(e){t.client.tcp.complete=t.client.tcp.complete.compose(r(10)("./"+e)),t.client.serial.complete=t.client.serial.complete.compose(r(10)("./"+e)),t.client.handler[e.substr(0,e.length-3)]=r(10)("./"+e)})),t.server={tcp:{core:r(37),complete:r(37)},handler:{}},i.readdirSync(o.join(__dirname,"/handler/server")).filter((function(e){return".js"===e.substr(-3)})).forEach((function(e){t.server.tcp.complete=t.server.tcp.complete.compose(r(38)("./"+e)),t.server.handler[e.substr(0,e.length-3)]=r(38)("./"+e)}))},function(e,t,r){"use strict";var i=r(2),o=r(9),n=r(28),s={1:"ILLEGAL FUNCTION",2:"ILLEGAL DATA ADDRESS",3:"ILLEGAL DATA VALUE",4:"SLAVE DEVICE FAILURE",5:"ACKNOWLEDGE",6:"SLAVE DEVICE BUSY",8:"MEMORY PARITY ERROR",10:"GATEWAY PATH UNAVAILABLE",11:"GATEWAY TARGET DEVICE FAILED TO RESPOND"};e.exports=i().compose(n).compose(o).init((function(){var e={},t=null;this.reqFifo=[];var r=function(){this.timeout||(this.timeout=5e3),this.on("data",n),this.on("newState_ready",i),this.on("newState_closed",o)}.bind(this),i=function(){this.log.debug("Trying to flush data."),0!==this.reqFifo.length?((t=this.reqFifo.shift()).timeout=setTimeout(function(){t.defer.reject({err:"timeout"}),this.emit("trashCurrentRequest"),this.logError("Request timed out."),this.setState("error")}.bind(this),this.timeout),this.setState("waiting"),this.emit("send",t.pdu),this.log.debug("Data flushed.")):this.log.debug("Nothing in request pipe.")}.bind(this),o=function(){t&&(this.log.debug("Clearing timeout of the current request."),clearTimeout(t.timeout)),this.log.debug("Cleaning up request fifo."),this.reqFifo=[]}.bind(this),n=function(r){if(this.log.debug("received data"),t){if(clearTimeout(t.timeout),function(e){var r=e.readUInt8(0);if(r<128)return!1;var i=e.readUInt8(1),o={errorCode:r,exceptionCode:i,message:s[i]};return t.defer.reject(o),!0}(r))return this.log.debug("Received pdu describes an error."),t=null,void this.setState("ready");var i=e[t.fc];if(!i)throw this.log.debug("Found not handler for fc",t.fc),new Error("No handler implemented for fc "+t.fc);i(r,t),this.setState("ready")}else this.log.debug("No current request.")}.bind(this);this.addResponseHandler=function(t,r){return e[t]=r,this}.bind(this),this.queueRequest=function(e,t,r){var o={fc:e,defer:r,pdu:t};this.reqFifo.push(o),this.inState("ready")&&i()},r()}))},function(e,t,r){"use strict";var i=r(2);e.exports=i().init((function(){var e,t,i=0,o=i,n=!1,s=!1,a=Buffer.alloc(0),d=!0,l=function(){this.setState("init"),this.unitId||(this.unitId=0),this.protocolVersion||(this.protocolVersion=0),this.port||(this.port=502),this.host||(this.host="localhost"),this.autoReconnect||(this.autoReconnect=!1),this.reconnectTimeout||(this.reconnectTimeout=0),this.on("send",g),this.on("newState_error",y),this.on("trashCurrentRequest",b),this.on("stateChanged",this.log.debug)}.bind(this),u=function(){this.setState("connect"),t||((t=this.injectedSocket?this.injectedSocket:r(7).Socket()).on("connect",c),t.on("close",f),t.on("error",p),t.on("data",h)),t.connect(this.port,this.host)}.bind(this),c=function(){d=!1,this.emit("connect"),this.setState("ready")}.bind(this),f=function(e){this.log.debug("Socket closed with error",e),this.setState("closed"),this.emit("close"),n||!this.autoReconnect&&!s||setTimeout((function(){s=!1,u()}),this.reconnectTimeout||0)}.bind(this),p=function(e){this.logError("Socket Error",e),this.setState("error"),this.emit("error",e)}.bind(this),h=function(t){for(this.log.debug("received data"),a=Buffer.concat([a,t]);a.length>7;){var r=a.readUInt16BE(0),i=a.readUInt16BE(4),n=a.readUInt16BE(2);if(0!==n)return this.log.debug("current mbap contains invalid protocol id."),this.setState("error"),console.log(n),void this.emit("error",new Error("Socket out of sync, received invalid protocol id"));if(r===e)return void this.log.debug("current mbap contains trashed request id.");if(r!==o)return this.log.debug("current mbap contains invalid request id."),this.setState("error"),void this.emit("error",new Error("Socket out of sync, received invalid request id"));if(a.length<7+i-1)break;var s=a.slice(7,7+i-1);this.log.debug("PDU extracted"),this.emit("data",s),a=a.slice(s.length+7,a.length)}}.bind(this),y=function(){this.logError("Client in error state."),t.destroy()}.bind(this),g=function(e){this.log.debug("Sending pdu to the socket."),i=(i+1)%65535;var r=Buffer.allocUnsafe(7);r.writeUInt16BE(i,0),r.writeUInt16BE(this.protocolVersion,2),r.writeUInt16BE(e.length+1,4),r.writeUInt8(this.unitId,6);var n=Buffer.concat([r,e]);o=i,t.write(n)}.bind(this),b=function(){e=o};this.connect=function(){return this.setState("connect"),u(),this},this.reconnect=function(){return this.inState("closed")?(n=!1,s=!0,this.log.debug("Reconnecting client."),t.end(),this):this},this.close=function(){return d||(d=!0,n=!0,this.log.debug("Closing client on purpose."),t.end()),this},process.env.DEBUG&&(this.getSocket=function(){return t},this.setCurrentRequestId=function(e){o=e},this.registerOnSend=function(e){this.removeListener(g),this.on("send",e.bind(this))}),l()}))},function(e,t,r){"use strict";var i=r(2),o=r(87),n=r(9),s=i().compose(o,n).init((function(){var e,t,r,i,o={},n=function(){e=this.coils?this.coils:Buffer.alloc(1024,0),t=this.holding?this.holding:Buffer.alloc(1024,0),r=this.input?this.input:Buffer.alloc(1024,0),i=this.discrete?this.discrete:r}.bind(this);this.onData=function(e,t){var r=e.readUInt8(0),i=o[r];if(!i){this.log.debug("no handler for fc",r);var n=Buffer.alloc(2);return n.writeUInt8(r+128,0),n.writeUInt8(1,1),void t(n)}i(e,(function(e){t(e)}))}.bind(this),this.setRequestHandler=function(e,t){return this.log.debug("setting request handler",e),o[e]=t,this},this.getCoils=function(){return e},this.getInput=function(){return r},this.getHolding=function(){return t},this.getDiscrete=function(){return i},n()}));e.exports=s},function(e,t){e.exports=require("stampit-event-bus")},function(e,t,r){"use strict";var i=r(2),o=r(9);e.exports=i().compose(o).init((function(){let e=Buffer.alloc(0),t=function(){if(!this.socket||void 0===this.socketId||!this.onRequest)throw new Error("No Socket defined.");this.socket.on("end",this.onSocketEnd),this.socket.on("data",this.onSocketData),this.socket.on("error",this.onSocketError)}.bind(this);this.onSocketEnd=function(){this.onEnd&&this.onEnd(),this.log.debug("connection closed, socket",this.socketId)}.bind(this),this.onSocketData=function(t){for(this.log.debug("received data socket",this.socketId,t.byteLength),e=Buffer.concat([e,t]);e.length>8;){let t=e.readUInt16BE(4),r={trans_id:e.readUInt16BE(0),protocol_ver:e.readUInt16BE(2),unit_id:e.readUInt8(6)};if(e.length<7+t-1)break;let i=e.slice(7,7+t);this.log.debug("PDU extracted."),this.onRequest({request:r,pdu:i,socket:this.socket}),e=e.slice(i.length+7,e.length)}}.bind(this),this.onSocketError=function(e){this.logError("Socker error",e)}.bind(this),t()}))},function(e,t,r){r(13);var i=r(1),o=r(5);e.exports=function(e,t){i.ChoiseModbus&&setInterval((function(){try{e.readHoldingRegisters(i.WordDisplayCobotStart,i.LengthOfWordDisplayCobot+i.LengthOfWordAdjustCobot).then((function(e){i.WordDisplay=o.ReadWordOfPLC(0,i.LengthOfWordDisplayCobot,e.register),i.WordAdjust=o.ReadWordOfPLC(20,i.LengthOfWordAdjustCobot,e.register),i.WordAdjust.push(i.counter)})).catch((function(){console.error(r(8).inspect(arguments,{depth:null}))}))}catch(e){console.log(e),StatusConnectPLC=0}}),100)}},function(e,t,r){var i=r(1);r(5),r(47).exec;e.exports=function(e,t){e.sockets.on("connection",(function(e){console.log("co nguoi ket noi"+e.id),e.emit("UpdateElement",i.resultElement),e.emit("UpdateBitAdjust",i.resultBitAdjust),e.emit("UpdateBitDisplay",i.resultBitDisplay),e.emit("UpdateWordAdjust",i.resultWordAdjust),e.emit("UpdateWordDisplay",i.resultWordDisplay),e.emit("UpdateDWordAdjust",i.resultDWordAdjust),e.emit("UpdateDWordDisplay",i.resultDWordDisplay),e.on("disconnect",(function(){console.log("ngat ket noi")})),e.on("initial",(function(){console.log("INITIAL"),e.emit("UpdateElement",i.resultElement),e.emit("UpdateBitAdjust",i.resultBitAdjust),e.emit("UpdateBitDisplay",i.resultBitDisplay),e.emit("UpdateWordAdjust",i.resultWordAdjust),e.emit("UpdateWordDisplay",i.resultWordDisplay),e.emit("UpdateDWordAdjust",i.resultDWordAdjust),e.emit("UpdateDWordDisplay",i.resultDWordDisplay)})),e.on("Client-send-data",(function(e){if(console.log(e),"BitAdjustForce"===e.NameCommand)try{t.write(e.tag+"\r\n")}catch(e){console.log(e)}if("WordAdjustForce"!==e.NameCommand||isNaN(e.tag)||(i.resultWordAdjust[e.tag]=e.value,console.log(i.resultWordAdjust)),"DWordAdjustForce"===e.NameCommand&&!isNaN(e.tag)){var r=parseInt(e.value/65536),o=parseInt(e.value%65536);conn.writeItems("ComPC",[112,112,e.tag,e.tag,r,r,o,o],()=>{console.log("can not write data Mitsubishi")})}if("TextFieldInput"===e.NameCommand){console.log(e);try{t.write(e.tag+" "+e.value+"\r\n")}catch(e){console.log(e)}}}))}))}},function(e,t,r){var o=r(7),n=r(92),s=r(8);function a(){this.readReq=new Buffer(1500),this.writeReq=new Buffer(1500),this.resetPending=!1,this.resetTimeout=void 0,this.maxPDU=255,this.isoclient=void 0,this.isoConnectionState=0,this.requestMaxParallel=1,this.maxParallel=1,this.isAscii=1,this.octalInputOutput,this.parallelJobsNow=0,this.maxGap=5,this.doNotOptimize=!1,this.connectCallback=void 0,this.readDoneCallback=void 0,this.writeDoneCallback=void 0,this.connectTimeout=void 0,this.PDUTimeout=void 0,this.globalTimeout=4500,this.readPacketArray=[],this.writePacketArray=[],this.polledReadBlockList=[],this.instantWriteBlockList=[],this.globalReadBlockList=[],this.globalWriteBlockList=[],this.masterSequenceNumber=1,this.translationCB=D,this.connectionParams=void 0,this.connectionID="UNDEF",this.addRemoveArray=[],this.readPacketValid=!1,this.writeInQueue=!1,this.connectCBIssued=!1}function d(e,t,r){var i;i=void 0===r?"":" "+r,(void 0===t||0>=t)&&console.log("["+process.hrtime()+i+"] "+s.format(e))}function l(e){return!(!e.sent||!e.rcvd)}function u(e,t,r){var i;i=void 0===e?0:e.length;if(t.qualityBuffer=new Buffer(t.byteLength),t.qualityBuffer.fill(255),i<2)return t.valid=!1,void 0!==e?(t.errCode="Malformed MC Packet - Less Than 2 Bytes.  TDL "+e.length+" TP "+r+" RL"+i,d(t.errCode,0)):(t.errCode="Timeout error - zero length packet",d(t.errCode,1)),0;if(129!==e[0])return t.valid=!1,t.errCode="Invalid MC - Expected first byte (binary) to be 0x81 (129) - got "+function(e){e<0&&(e=4294967295+e+1);return"0x"+e.toString(16).toUpperCase()}(e[0])+" ("+e[0]+")",d(t.errCode),1;if(0!==e[1])return t.valid=!1,t.errCode="MC Error Response - Second Byte is "+e[1]+" and error code is "+e[2],d(t.errCode),1;if(expectedLength=t.byteLength,e.length-2!==expectedLength)return t.valid=!1,t.errCode="Invalid Response Length - Expected "+expectedLength+" but got "+(e.length-2)+" bytes.",d(t.errCode),1;r+=2;return t.valid=!0,t.byteBuffer=e.slice(2),d("Byte Buffer is:",2),d(t.byteBuffer,2),t.qualityBuffer.fill(192),d("Marking quality as good L"+t.qualityBuffer.length,2),-1}function c(e,t,r){return void 0===e||e.length<2?(t.valid=!1,t.errCode="Malformed Reply MC Packet - Less Than 2 Bytes"+e,d(t.errCode),t.writeQualityBuffer.fill(255),0):(0!==e.readUInt8(1)||130!==e[0]&&131!==e[0]?(e.length>2?d("Received response "+e[0]+" "+e[1]+" "+e[2]+") indicating write error on "+t.addr):d("Received response "+e[0]+" "+e[1]+") indicating write error on "+t.addr),t.writeQualityBuffer.fill(255)):t.writeQualityBuffer.fill(192),-1)}function f(e){var t=0;if(1===e.arrayLength)255===e.writeQualityBuffer[0]?e.writeQuality="BAD":e.writeQuality="OK";else for(e.writeQuality=[],arrayIndex=0;arrayIndex<e.arrayLength;arrayIndex++)255===e.writeQualityBuffer[t]?e.writeQuality[arrayIndex]="BAD":e.writeQuality[arrayIndex]="OK","X"==e.datatype&&(arrayIndex+e.bitOffset+1)%8!=0&&arrayIndex!=e.arrayLength-1||(t+=e.dtypelen)}function p(e,t){var r=0;new Buffer(4);if(e.arrayLength>1){"C"!=e.datatype&&"CHAR"!=e.datatype?(e.value=[],e.quality=[]):(e.value="",e.quality="");var i=e.bitOffset;for(e.bitNative&&(i=e.remainder),arrayIndex=0;arrayIndex<e.arrayLength;arrayIndex++){if(192!==e.qualityBuffer[r])e.value.push(e.badValue()),e.quality.push("BAD "+e.qualityBuffer[r]),d("Logging a Bad Quality thePointer "+r,2);else switch(e.quality instanceof Array?e.quality.push("OK"):e.quality="OK",e.datatype){case"REAL":t?e.value.push(w(e.byteBuffer,r)):e.value.push(e.byteBuffer.readFloatLE(r));break;case"DWORD":t?e.value.push(k(e.byteBuffer,r)):e.value.push(e.byteBuffer.readUInt32LE(r));break;case"DINT":t?e.value.push(A(e.byteBuffer,r)):e.value.push(e.byteBuffer.readInt32LE(r));break;case"INT":t?e.value.push(e.byteBuffer.readInt16BE(r)):e.value.push(e.byteBuffer.readInt16LE(r));break;case"WORD":t?e.value.push(e.byteBuffer.readUInt16BE(r)):e.value.push(e.byteBuffer.readUInt16LE(r));break;case"X":e.bitNative,t?e.value.push(!!(e.byteBuffer.readUInt16BE(r)>>i&1)):e.value.push(!!(e.byteBuffer.readUInt16LE(r)>>i&1));break;case"B":case"BYTE":t?arrayIndex%2?e.value.push(e.byteBuffer.readUInt8(r-1)):e.value.push(e.byteBuffer.readUInt8(r+1)):e.value.push(e.byteBuffer.readUInt8(r));break;case"C":case"CHAR":t?arrayIndex%2?e.value+=String.fromCharCode(e.byteBuffer.readUInt8(r-1)):e.value+=String.fromCharCode(e.byteBuffer.readUInt8(r+1)):e.value+=String.fromCharCode(e.byteBuffer.readUInt8(r));break;default:return d("Unknown data type in response - should never happen.  Should have been caught earlier.  "+e.datatype),0}"X"==e.datatype?(i++,e.bitNative?(arrayIndex+e.remainder+1)%16!=0&&arrayIndex!=e.arrayLength-1||(r+=e.dtypelen,i=0):(arrayIndex+e.bitOffset+1)%16!=0&&arrayIndex!=e.arrayLength-1||(r+=e.dtypelen,i=0)):r+=e.dtypelen}}else{if(192!==e.qualityBuffer[r])e.value=e.badValue(),e.quality="BAD "+e.qualityBuffer[r],d("Item Quality is Bad",1);else switch(e.quality="OK",d("Item Datatype (single value) is "+e.datatype,1),e.datatype){case"REAL":e.value=t?w(e.byteBuffer,r):e.byteBuffer.readFloatLE(r);break;case"DWORD":e.value=t?k(e.byteBuffer,r):e.byteBuffer.readUInt32LE(r);break;case"DINT":e.value=t?A(e.byteBuffer,r):e.byteBuffer.readInt32LE(r);break;case"INT":e.value=t?e.byteBuffer.readInt16BE(r):e.byteBuffer.readInt16LE(r);break;case"WORD":e.value=t?e.byteBuffer.readUInt16BE(r):e.byteBuffer.readUInt16LE(r);break;case"X":e.bitNative?e.value=t?!!(e.byteBuffer.readUInt16BE(r)>>e.remainder&1):!!(e.byteBuffer.readUInt16LE(r)>>e.remainder&1):e.value=t?!!(e.byteBuffer.readUInt16BE(r)>>e.bitOffset&1):!!(e.byteBuffer.readUInt16LE(r)>>e.bitOffset&1);break;case"B":case"BYTE":e.value=t?e.byteBuffer.readUInt8(r+1):e.byteBuffer.readUInt8(r);break;case"C":case"CHAR":e.value=t?String.fromCharCode(e.byteBuffer.readUInt8(r+1)):String.fromCharCode(e.byteBuffer.readUInt8(r));break;default:return d("Unknown data type in response - should never happen.  Should have been caught earlier.  "+e.datatype),0}r+=e.dtypelen}return r%2&&(r+=1),r}function h(e,t){var r,i;if(i=0,r=0,e.arrayLength>1){e.bitOffset;for(arrayIndex=0;arrayIndex<e.arrayLength;arrayIndex++){switch(e.datatype){case"REAL":t?B(e.writeBuffer,r,e.writeValue[arrayIndex]):e.writeBuffer.writeFloatLE(e.writeValue[arrayIndex],r);break;case"DWORD":t?C(e.writeBuffer,r,e.writeValue[arrayIndex]):e.writeBuffer.writeUInt32LE(e.writeValue[arrayIndex],r);break;case"DINT":t?R(e.writeBuffer,r,e.writeValue[arrayIndex]):e.writeBuffer.writeInt32LE(e.writeValue[arrayIndex],r);break;case"INT":t?e.writeBuffer.writeInt16BE(e.writeValue[arrayIndex],r):e.writeBuffer.writeInt16LE(e.writeValue[arrayIndex],r);break;case"WORD":t?e.writeBuffer.writeUInt16BE(e.writeValue[arrayIndex],r):e.writeBuffer.writeUInt16LE(e.writeValue[arrayIndex],r);break;case"X":arrayIndex%2?i|=!0===e.writeValue[arrayIndex]?1:0:i|=(!0===e.writeValue[arrayIndex]?1:0)<<4,e.writeBuffer.writeUInt8(i,r),e.writeBuffer.writeUInt8(0,r+1);break;case"B":case"BYTE":t?arrayIndex%2?e.writeBuffer.writeUInt8(e.writeValue[arrayIndex],r-1):e.writeBuffer.writeUInt8(e.writeValue[arrayIndex],r+1):e.writeBuffer.writeUInt8(Math.round(e.writeValue[arrayIndex]),r);break;case"C":case"CHAR":t?arrayIndex%2?e.writeBuffer.writeUInt8(e.writeValue.charCodeAt(arrayIndex),r-1):e.writeBuffer.writeUInt8(e.writeValue.charCodeAt(arrayIndex),r+1):e.writeBuffer.writeUInt8(e.writeValue.charCodeAt(arrayIndex),r);break;default:return d("Unknown data type when preparing array write packet - should never happen.  Should have been caught earlier.  "+e.datatype),0}"X"==e.datatype?arrayIndex%2&&(r+=1,i=0):r+=e.dtypelen}}else{switch(e.datatype){case"REAL":t?B(e.writeBuffer,r,e.writeValue):e.writeBuffer.writeFloatLE(e.writeValue,r);break;case"DWORD":t?C(e.writeBuffer,r,e.writeValue):e.writeBuffer.writeUInt32LE(e.writeValue,r);break;case"DINT":t?R(e.writeBuffer,r,e.writeValue):e.writeBuffer.writeInt32LE(e.writeValue,r);break;case"INT":t?e.writeBuffer.writeInt16BE(e.writeValue,r):e.writeBuffer.writeInt16LE(e.writeValue,r);break;case"WORD":t?e.writeBuffer.writeUInt16BE(e.writeValue,r):e.writeBuffer.writeUInt16LE(e.writeValue,r);break;case"X":e.bitNative?(e.writeBuffer.writeUInt8(e.writeValue?16:0,r),e.writeBuffer.writeUInt8(0,r+1),d("Datatype is X writing "+e.writeValue+" tpi "+e.writeBuffer[0],1)):d("We don't support writing individual bits of non-native types - write the whole word externally please",0);break;case"B":case"BYTE":t?(e.writeBuffer.writeUInt8(Math.round(e.writeValue),r+1),e.writeBuffer.writeUInt8(0,r)):e.writeBuffer.writeUInt8(Math.round(e.writeValue),r);break;case"C":case"CHAR":t?(e.writeBuffer.writeUInt8(String.toCharCode(e.writeValue),r+1),e.writeBuffer.writeUInt8(0,r)):e.writeBuffer.writeUInt8(String.toCharCode(e.writeValue),r);break;default:return d("Unknown data type in write prepare - should never happen.  Should have been caught earlier.  "+e.datatype),0}r+=e.dtypelen}}function y(e){if("string"==typeof e){if("OK"!==e)return!1}else if(n.isArray(e))for(i=0;i<e.length;i++)if("string"!=typeof e[i]||"OK"!==e[i])return!1;return!0}function g(e,t,r){var i,o=new Buffer(300);return 4,e.bitNative?o[0]=t?2:1:o[0]=t?3:1,o[1]=255,r?(d("We're Ascii",2),o.writeUInt16BE(10,2)):(d("We're Binary",2),o.writeUInt16LE(10,2)),i=t?e.byteLengthWrite:0,r?o.writeUInt16BE(e.areaMCCode,4):o.writeUInt16LE(e.areaMCCode,8),r?t?o.writeUInt32BE(e.offset,6):o.writeUInt32BE(e.requestOffset,6):t?o.writeUInt32LE(e.offset,4):o.writeUInt32LE(e.requestOffset,4),e.bitNative&&t?o.writeUInt8(e.arrayLength,10):e.bitNative&&!t?o.writeUInt8(Math.ceil((e.arrayLength+e.remainder)/16),10):t?o.writeUInt8(e.byteLengthWrite/2,10):o.writeUInt8(e.byteLength/2,10),o.writeUInt8(0,11),t&&e.writeBuffer.copy(o,12,0,i),o.slice(0,12+i)}function b(e,t,r){"use strict";var i,o,n,s,a;if(i=new v,"_COMMERR"!==t){2==(o=e.split(",")).length?i.arrayLength=parseInt(o[1].replace(/[A-z]/gi,""),10):i.arrayLength=1,o[0]=o[0].replace("/",".");var l=o[0].split(".");if(l.length>2)d("Error - String Couldn't Split Properly.  Only one dot or slash.");else{switch(2==l.length&&(d("PostDotNumeric is "+(s=parseInt(l[1].replace(/[A-z]/gi,""),10)),2),o[0]=l[0]),i.offset=parseInt(o[0].replace(/[A-z]/gi,""),10),"X"!==(n=o[0].replace(/[0-9]/gi,""))&&"Y"!==n||!r||(a=i.offset,i.offset=parseInt(i.offset.toString(),8),isNaN(i.offset)&&(i.offset=a)),n){case"DFLOAT":i.addrtype="D",i.datatype="REAL",i.multidtypelen=4,i.remainder=0,i.requestOffset=i.offset,i.dtypelen=4;break;case"DDINT":i.addrtype="D",i.datatype="DINT",i.multidtypelen=4,i.remainder=0,i.requestOffset=i.offset,i.dtypelen=4;break;case"RFLOAT":i.addrtype="R",i.datatype="REAL",i.multidtypelen=4,i.remainder=0,i.requestOffset=i.offset,i.dtypelen=4;break;case"RDINT":i.addrtype="R",i.datatype="DINT",i.multidtypelen=4,i.remainder=0,i.requestOffset=i.offset,i.dtypelen=4;break;case"DSTR":i.addrtype="D",i.datatype="CHAR",i.multidtypelen=1,i.remainder=0,i.requestOffset=i.offset,i.dtypelen=1;break;case"RSTR":i.addrtype="R",i.datatype="CHAR",i.multidtypelen=1,i.remainder=0,i.requestOffset=i.offset,i.dtypelen=1;break;case"TN":case"CN":case"D":case"R":i.addrtype=n,void 0!==s?(i.datatype="X",i.bitOffset=s):i.datatype="INT","CN"===i.addrtype&&i.offset>=200?(i.dtypelen=4,i.multidtypelen=4,i.datatype="DINT"):(i.dtypelen=2,i.multidtypelen=2),i.remainder=0,i.requestOffset=i.offset;break;case"TS":case"CS":i.addrtype=n,i.datatype="X",i.multidtypelen=2,i.remainder=i.offset%16,i.requestOffset=i.offset-i.remainder,i.dtypelen=2;break;case"X":case"Y":case"M":case"S":i.addrtype=n,i.datatype="X",i.multidtypelen=2,i.remainder=i.offset%16,i.requestOffset=i.offset-i.remainder,i.dtypelen=2;break;default:return void d("Failed to find a match for "+o[0]+" possibly because "+n+" type is not supported yet.")}switch("D"===i.addrtype||"R"===i.addrtype||"TN"===i.addrtype||"CN"===i.addrtype?i.bitNative=!1:i.bitNative=!0,i.addrtype){case"D":i.areaMCCode=17440;break;case"R":i.areaMCCode=21024;break;case"TN":i.areaMCCode=21582;break;case"TS":i.areaMCCode=21587;break;case"CN":i.areaMCCode=17230;break;case"CS":i.areaMCCode=17235;break;case"X":i.areaMCCode=22560;break;case"Y":i.areaMCCode=22816;break;case"M":i.areaMCCode=19744;break;case"S":i.areaMCCode=21280;break;default:return void d("Failed to find a match for "+i.addrtype+" possibly because that type is not supported yet.")}if(i.addr=e,i.useraddr=void 0===t?e:t,"X"===i.datatype?i.wordLength=Math.ceil((i.remainder+i.arrayLength)/16):i.wordLength=i.arrayLength*i.dataTypeByteLength()/2,i.byteLength=2*i.wordLength,i.byteLengthWrite=i.bitNative?Math.ceil(i.arrayLength/2):i.byteLength,i.totalArrayLength=i.arrayLength,!("CN"===i.addrtype&&i.requestOffset<200&&i.requestOffset+i.arrayLength>200))return i;d("IMPORTANT NOTE: You can't have a counter array that crosses the 200-point boundary.")}}}function m(){this.seqNum=void 0,this.itemList=void 0,this.reqTime=void 0,this.sent=!1,this.rcvd=!1,this.timeoutError=void 0,this.timeout=void 0}function v(){this.areaMCCode=void 0,this.bitNative=void 0,this.startRegister=void 0,this.byteLengthWrite=void 0,this.addr=void 0,this.useraddr=void 0,this.addrtype=void 0,this.datatype=void 0,this.bitOffset=void 0,this.byteOffset=void 0,this.offset=void 0,this.arrayLength=void 0,this.totalArrayLength=void 0,this.maxWordLength=function(e){if(void 0===this.addrtype)return 1;switch(this.addrtype){case"D":case"R":case"TN":return 64;case"CN":return void 0===this.offset||this.offset<0?1:this.offset>=200?32:Math.max(199-this.offset,64);case"TS":case"CS":case"X":case"Y":case"M":case"S":return e?40:16;default:return void d("Failed to find a match for "+theItem.addrtype+" possibly because that type is not supported yet.")}},this.dataTypeByteLength=function(){if(void 0===this.addrtype)return 1;switch(this.addrtype){case"D":case"R":return"REAL"===this.datatype||"DINT"===this.datatype||"DWORD"===this.datatype?4:"CHAR"===this.datatype?1:2;case"TN":return 2;case"CN":return void 0===this.offset||this.offset<0?1:this.offset>=200?4:2;case"TS":case"CS":case"X":case"Y":case"M":case"S":return 1;default:return void d("Failed to find a match for "+theItem.addrtype+" possibly because that type is not supported yet.")}},this.dtypelen=void 0,this.multidtypelen=void 0,this.areaMCCode=void 0,this.byteLength=void 0,this.byteLengthWithFill=void 0,this.readTransportCode=void 0,this.writeTransportCode=void 0,this.byteBuffer=new Buffer(8192),this.writeBuffer=new Buffer(8192),this.qualityBuffer=new Buffer(8192),this.writeQualityBuffer=new Buffer(8192),this.value=void 0,this.writeValue=void 0,this.valid=!1,this.errCode=void 0,this.part=void 0,this.maxPart=void 0,this.isOptimized=!1,this.resultReference=void 0,this.itemReference=void 0,this.clone=function(){var e=new v;for(var t in this)"clone"!=t&&(e[t]=this[t]);return e},this.badValue=function(){switch(this.datatype){case"REAL":return 0;case"DWORD":case"DINT":case"INT":case"WORD":case"B":case"BYTE":return 0;case"X":return!1;case"C":case"CHAR":return"";default:return d("Unknown data type when figuring out bad value - should never happen.  Should have been caught earlier.  "+this.datatype),0}}}function I(e,t){return e.areaMCCode<t.areaMCCode?-1:e.areaMCCode>t.areaMCCode?1:e.offset<t.offset?-1:e.offset>t.offset?1:e.bitOffset<t.bitOffset?-1:e.bitOffset>t.bitOffset?1:e.byteLength>t.byteLength?-1:e.byteLength<t.byteLength?1:void 0}function D(e){return e}function w(e,t){var r=new Buffer(4);return r[0]=e[t+2],r[1]=e[t+3],r[2]=e[t+0],r[3]=e[t+1],r.readFloatBE(0)}function B(e,t,r){var i=new Buffer(4);i.writeFloatBE(r,0),e[t+2]=i[0],e[t+3]=i[1],e[t+0]=i[2],e[t+1]=i[3]}function A(e,t){var r=new Buffer(4);return r[0]=e[t+2],r[1]=e[t+3],r[2]=e[t+0],r[3]=e[t+1],r.readInt32BE(0)}function R(e,t,r){var i=new Buffer(4);i.writeInt32BE(Math.round(r),0),e[t+2]=i[0],e[t+3]=i[1],e[t+0]=i[2],e[t+1]=i[3]}function k(e,t){var r=new Buffer(4);return r[0]=e[t+2],r[1]=e[t+3],r[2]=e[t+0],r[3]=e[t+1],r.readUInt32BE(0)}function C(e,t,r){var i=new Buffer(4);i.writeUInt32BE(Math.round(r),0),e[t+2]=i[0],e[t+3]=i[1],e[t+0]=i[2],e[t+1]=i[3]}function L(e){var t,r;if(e&&!(e.length%2)){for(r=new Buffer(e.length/2),t=0;t<e.length;t+=2)if(r[t/2]=parseInt("0x"+e.toString("ascii",t,t+2)),isNaN(r[t/2]))return;return r}}function S(e){var t,r,i,o;if(e){for(r=new Buffer(2*e.length),t=0;t<e.length;t+=1)r.write((i=e[t],o=void 0,o=2-i.toString(16).length+1,Array(+(o>0&&o)).join("0")+i.toString(16)),2*t,2,"ascii");return r}}e.exports=a,a.prototype.setTranslationCB=function(e){"function"==typeof e&&(d("Translation OK"),this.translationCB=e)},a.prototype.initiateConnection=function(e,t){void 0===e&&(e={port:1e4,host:"192.168.8.106",ascii:!1}),d("Initiate Called - Connecting to PLC with address and parameters:"),d(e),void 0===e.name?this.connectionID=e.host:this.connectionID=e.name,void 0===e.ascii?this.isAscii=!1:this.isAscii=e.ascii,void 0===e.octalInputOutput?this.octalInputOutput=!0:this.octalInputOutput=e.octalInputOutput,this.connectionParams=e,this.connectCallback=t,this.connectCBIssued=!1,this.connectNow(this.connectionParams,!1)},a.prototype.dropConnection=function(){void 0!==this.isoclient&&this.isoclient.end(),this.connectionCleanup()},a.prototype.connectNow=function(e,t){var r=this;r.isoConnectionState>=1||(r.connectionCleanup(),r.isoclient=o.connect(e,(function(){r.onTCPConnect.apply(r,arguments)})),r.isoclient.setKeepAlive(!0,2500),r.isoConnectionState=1,r.isoclient.on("error",(function(){r.connectError.apply(r,arguments)})),d("<initiating a new connection>",1,r.connectionID),d("Attempting to connect to host...",0,r.connectionID))},a.prototype.connectError=function(e){d("We Caught a connect error "+e.code,0,this.connectionID),this.connectCBIssued||"function"!=typeof this.connectCallback||(this.connectCBIssued=!0,this.connectCallback(e)),this.isoConnectionState=0},a.prototype.readWriteError=function(e){d("We Caught a read/write error "+e.code+" - resetting connection",0,this.connectionID),this.isoConnectionState=0,this.connectionReset()},a.prototype.packetTimeout=function(e,t){return d("PacketTimeout called with type "+e+" and seq "+t,1,this.connectionID),"read"===e?(d("READ TIMEOUT on sequence number "+t,0,this.connectionID),void this.readResponse(void 0)):"write"===e?(d("WRITE TIMEOUT on sequence number "+t,0,this.connectionID),void this.writeResponse(void 0)):void d("Unknown timeout error.  Nothing was done - this shouldn't happen.",0,this.connectionID)},a.prototype.onTCPConnect=function(){var e=this;d("TCP Connection Established to "+e.isoclient.remoteAddress+" on port "+e.isoclient.remotePort,0,e.connectionID),e.isoConnectionState=4,e.isoclient.removeAllListeners("data"),e.isoclient.removeAllListeners("error"),e.isoclient.on("data",(function(){e.onResponse.apply(e,arguments)})),e.isoclient.on("error",(function(){e.readWriteError.apply(e,arguments)})),e.connectCBIssued||"function"!=typeof e.connectCallback||(e.connectCBIssued=!0,e.connectCallback())},a.prototype.writeItems=function(e,t,r){var i;if(d("Preparing to WRITE "+e,0,this.connectionID),this.isWriting())d("You must wait until all previous writes have finished before scheduling another. ",0,this.connectionID);else{if(this.writeDoneCallback="function"==typeof r?r:D,this.instantWriteBlockList=[],"string"==typeof e)this.instantWriteBlockList.push(b(this.translationCB(e),e,this.octalInputOutput)),void 0!==this.instantWriteBlockList[this.instantWriteBlockList.length-1]&&(this.instantWriteBlockList[this.instantWriteBlockList.length-1].writeValue=t);else if(n.isArray(e)&&n.isArray(t)&&e.length==t.length)for(i=0;i<e.length;i++)"string"==typeof e[i]&&(this.instantWriteBlockList.push(b(this.translationCB(e[i]),e[i],this.octalInputOutput)),void 0!==this.instantWriteBlockList[this.instantWriteBlockList.length-1]&&(this.instantWriteBlockList[this.instantWriteBlockList.length-1].writeValue=t[i]));for(i=this.instantWriteBlockList.length-1;i>=0;i--)void 0===this.instantWriteBlockList[i]&&(this.instantWriteBlockList.splice(i,1),d("Dropping an undefined write item."));this.prepareWritePacket(),this.isReading()?this.writeInQueue=!0:this.sendWritePacket()}},a.prototype.findItem=function(e){var t,r={value:4!==this.isoConnectionState,quality:"OK"};if("_COMMERR"===e)return r;for(t=0;t<this.polledReadBlockList.length;t++)if(this.polledReadBlockList[t].useraddr===e)return this.polledReadBlockList[t]},a.prototype.addItems=function(e){this.addRemoveArray.push({arg:e,action:"add"})},a.prototype.addItemsNow=function(e){var t;if(d("Adding "+e,0,this.connectionID),addItemsFlag=!1,"string"==typeof e&&"_COMMERR"!==e)this.polledReadBlockList.push(b(this.translationCB(e),e,this.octalInputOutput));else if(n.isArray(e))for(t=0;t<e.length;t++)"string"==typeof e[t]&&"_COMMERR"!==e[t]&&this.polledReadBlockList.push(b(this.translationCB(e[t]),e[t],this.octalInputOutput));for(t=this.polledReadBlockList.length-1;t>=0;t--)void 0===this.polledReadBlockList[t]&&(this.polledReadBlockList.splice(t,1),d("Dropping an undefined request item."));this.readPacketValid=!1},a.prototype.removeItems=function(e){this.addRemoveArray.push({arg:e,action:"remove"})},a.prototype.removeItemsNow=function(e){var t;if(this.removeItemsFlag=!1,void 0===e)this.polledReadBlockList=[];else if("string"==typeof e)for(t=0;t<this.polledReadBlockList.length;t++)d("TCBA "+this.translationCB(e)),this.polledReadBlockList[t].addr===this.translationCB(e)&&(d("Splicing"),this.polledReadBlockList.splice(t,1));else if(n.isArray(e))for(t=0;t<this.polledReadBlockList.length;t++)for(j=0;j<e.length;j++)this.polledReadBlockList[t].addr===this.translationCB(e[j])&&this.polledReadBlockList.splice(t,1);this.readPacketValid=!1},a.prototype.readAllItems=function(e){var t=this;if(d("Reading All Items (readAllItems was called)",1,t.connectionID),t.readDoneCallback="function"==typeof e?e:D,4!==t.isoConnectionState&&d("Unable to read when not connected. Return bad values.",0,t.connectionID),t.isWaiting())return d("Waiting to read for all R/W operations to complete.  Will re-trigger readAllItems in 100ms."),void setTimeout((function(){t.readAllItems.apply(t,arguments)}),100,e);t.addRemoveArray.forEach((function(e){d("Adding or Removing "+s.format(e),1,t.connectionID),"remove"===e.action&&t.removeItemsNow(e.arg),"add"===e.action&&t.addItemsNow(e.arg)})),t.addRemoveArray=[],t.readPacketValid||t.prepareReadPacket(),d("Calling SRP from RAI",1,t.connectionID),t.sendReadPacket()},a.prototype.isWaiting=function(){return this.isReading()||this.isWriting()},a.prototype.isReading=function(){var e;for(e=0;e<this.readPacketArray.length;e++)if(!0===this.readPacketArray[e].sent)return!0;return!1},a.prototype.isWriting=function(){var e;for(e=0;e<this.writePacketArray.length;e++)if(!0===this.writePacketArray[e].sent)return!0;return!1},a.prototype.clearReadPacketTimeouts=function(){for(d("Clearing read PacketTimeouts",1,this.connectionID),i=0;i<this.readPacketArray.length;i++)clearTimeout(this.readPacketArray[i].timeout),this.readPacketArray[i].sent=!1,this.readPacketArray[i].rcvd=!1},a.prototype.clearWritePacketTimeouts=function(){for(d("Clearing write PacketTimeouts",1,this.connectionID),i=0;i<this.writePacketArray.length;i++)clearTimeout(this.writePacketArray[i].timeout),this.writePacketArray[i].sent=!1,this.writePacketArray[i].rcvd=!1},a.prototype.prepareWritePacket=function(){var e,t=this.instantWriteBlockList,r=[],i=0;if(t.sort(I),0!=t.length){this.globalWriteBlockList[0]=t[0],this.globalWriteBlockList[0].itemReference=[],this.globalWriteBlockList[0].itemReference.push(t[0]);var o=0;for(t[0].block=0,f=0;f<t.length;f++)this.globalWriteBlockList[f]=t[f],this.globalWriteBlockList[f].isOptimized=!1,this.globalWriteBlockList[f].itemReference=[],this.globalWriteBlockList[f].itemReference.push(t[f]),h(t[f],this.isAscii);for(f=0;f<this.globalWriteBlockList.length;f++){var n=this.globalWriteBlockList[f].offset,s=this.globalWriteBlockList[f].byteLengthWrite,a=this.globalWriteBlockList[f].totalArrayLength,l=2*this.globalWriteBlockList[f].maxWordLength(!0),u=0;for(r[o]=this.globalWriteBlockList[f].clone(),this.globalWriteBlockList[f].parts=Math.ceil(this.globalWriteBlockList[f].byteLengthWrite/l),d("globalWriteBlockList "+f+" parts is "+this.globalWriteBlockList[f].parts+" offset is "+this.globalWriteBlockList[f].offset+" MBR is "+l,2),this.globalWriteBlockList[f].requestReference=[],j=0;j<this.globalWriteBlockList[f].parts;j++)r[o]=this.globalWriteBlockList[f].clone(),this.globalWriteBlockList[f].requestReference.push(r[o]),r[o].offset=n,r[o].byteLengthWrite=Math.min(l,s),r[o].bitNative?r[o].totalArrayLength=Math.min(2*l,a,this.globalWriteBlockList[f].totalArrayLength):r[o].totalArrayLength=Math.min(l/this.globalWriteBlockList[f].dtypelen,s/this.globalWriteBlockList[f].dtypelen,this.globalWriteBlockList[f].totalArrayLength),a-=r[o].totalArrayLength,r[o].byteLengthWithFill=r[o].byteLengthWrite,r[o].writeBuffer=this.globalWriteBlockList[f].writeBuffer.slice(u,u+r[o].byteLengthWithFill),r[o].writeQualityBuffer=this.globalWriteBlockList[f].writeQualityBuffer.slice(u,u+r[o].byteLengthWithFill),u+=this.globalWriteBlockList[f].requestReference[j].byteLengthWrite,this.globalWriteBlockList[f].parts>1&&(r[o].datatype="BYTE",r[o].dtypelen=1,r[o].bitNative?r[o].arrayLength=r[o].totalArrayLength:r[o].arrayLength=r[o].byteLengthWrite/2),s-=l,this.globalWriteBlockList[f].bitNative?n+=2*l:n+=l/2,o++}for(this.clearWritePacketTimeouts(),this.writePacketArray=[];i<r.length;){this.masterSequenceNumber+=1,this.masterSequenceNumber>32767&&(this.masterSequenceNumber=1),e=0;this.writePacketArray.push(new m);var c=this.writePacketArray.length-1;this.writePacketArray[c].seqNum=this.masterSequenceNumber,this.writePacketArray[c].itemList=[];for(var f=i;f<r.length&&1!=e;f++)i++,e++,r[f].byteLengthWithFill+4,this.writePacketArray[c].itemList.push(r[f])}d("WPAL is "+this.writePacketArray.length,1)}},a.prototype.prepareReadPacket=function(){var e,t,r=this.polledReadBlockList,i=[];for(p=r.length-1;p>=0;p--)void 0===r[p]&&(r.splice(p,1),d("Dropping an undefined request item.",0,this.connectionID));if(r.sort(I),0!=r.length){this.globalReadBlockList=[],this.globalReadBlockList[0]=r[0],this.globalReadBlockList[0].itemReference=[],this.globalReadBlockList[0].itemReference.push(r[0]);var o,n=0;for(r[0].block=n,p=1;p<r.length;p++)o=2*r[p].maxWordLength(!0),r[p].areaMCCode!==this.globalReadBlockList[n].areaMCCode||!this.isOptimizableArea(r[p].areaMCCode)||r[p].offset-this.globalReadBlockList[n].offset+r[p].byteLength>o||r[p].offset-(this.globalReadBlockList[n].offset+this.globalReadBlockList[n].byteLength)>this.maxGap&&!r[p].bitNative||r[p].offset-(this.globalReadBlockList[n].offset+this.globalReadBlockList[n].byteLength)>8*this.maxGap&&r[p].bitNative?(n+=1,this.globalReadBlockList[n]=r[p],this.globalReadBlockList[n].isOptimized=!1,this.globalReadBlockList[n].itemReference=[],this.globalReadBlockList[n].itemReference.push(r[p])):(d("Performing optimization of item "+r[p].addr+" with "+this.globalReadBlockList[n].addr,1),r[p].bitNative?(this.globalReadBlockList[n].byteLength=Math.max(this.globalReadBlockList[n].byteLength,Math.floor((r[p].requestOffset-this.globalReadBlockList[n].requestOffset)/8)+r[p].byteLength),this.globalReadBlockList[n].byteLength%2&&(this.globalReadBlockList[n].byteLength+=1)):this.globalReadBlockList[n].byteLength=Math.max(this.globalReadBlockList[n].byteLength,(2*(r[p].offset-this.globalReadBlockList[n].offset)+Math.ceil(r[p].byteLength/r[p].multidtypelen))*r[p].multidtypelen),d("Optimized byte length is now "+this.globalReadBlockList[n].byteLength,1),t=(e=r[p].bitNative?(r[p].requestOffset-this.globalReadBlockList[n].requestOffset)/8:2*(r[p].requestOffset-this.globalReadBlockList[n].requestOffset))+r[p].byteLength,r[p].byteBuffer=this.globalReadBlockList[n].byteBuffer.slice(e,t),r[p].qualityBuffer=this.globalReadBlockList[n].qualityBuffer.slice(e,t),this.globalReadBlockList[n].isOptimized=!0,this.globalReadBlockList[n].itemReference.push(r[p]));var s=0;for(p=0;p<this.globalReadBlockList.length;p++){i[s]=this.globalReadBlockList[p].clone(),o=2*this.globalReadBlockList[p].maxWordLength(!0),this.globalReadBlockList[p].parts=Math.ceil(this.globalReadBlockList[p].byteLength/o);var a=this.globalReadBlockList[p].requestOffset,l=this.globalReadBlockList[p].byteLength;this.globalReadBlockList[p].totalArrayLength;for(this.globalReadBlockList[p].requestReference=[],j=0;j<this.globalReadBlockList[p].parts;j++)i[s]=this.globalReadBlockList[p].clone(),this.globalReadBlockList[p].requestReference.push(i[s]),i[s].requestOffset=a,i[s].byteLength=Math.min(o,l),i[s].bitNative?i[s].totalArrayLength=Math.min(8*o,8*l,this.globalReadBlockList[p].totalArrayLength):i[s].totalArrayLength=Math.min(o/this.globalReadBlockList[p].dtypelen,l/this.globalReadBlockList[p].dtypelen,this.globalReadBlockList[p].totalArrayLength),i[s].byteLengthWithFill=i[s].byteLength,i[s].byteLengthWithFill%2&&(i[s].byteLengthWithFill+=1),this.globalReadBlockList[p].parts>1&&(i[s].datatype="BYTE",i[s].dtypelen=1,i[s].bitNative?i[s].arrayLength=i[s].totalArrayLength:i[s].arrayLength=i[s].byteLength/2),l-=o,this.globalReadBlockList[p].bitNative?a+=8*o:a+=o/2,s++}var u=0;for(this.clearReadPacketTimeouts(),this.readPacketArray=[];u<i.length;){this.masterSequenceNumber+=1,this.masterSequenceNumber>32767&&(this.masterSequenceNumber=1);var c=0;this.readPacketArray.push(new m);var f=this.readPacketArray.length-1;this.readPacketArray[f].seqNum=this.masterSequenceNumber,this.readPacketArray[f].itemList=[];for(var p=u;p<i.length&&!(c>=1);p++)u++,c++,this.readPacketArray[f].itemList.push(i[p])}this.readPacketValid=!0}},a.prototype.sendReadPacket=function(){var e,t,r,i,o=this,n=!1;for(d("SendReadPacket called",1,o.connectionID),e=0;e<o.readPacketArray.length;e++)if(!(o.readPacketArray[e].sent||o.parallelJobsNow>=o.maxParallel)){for(o.readPacketArray[e].reqTime=process.hrtime(),r=0,0,t=0;t<o.readPacketArray[e].itemList.length;t++)i=g(o.readPacketArray[e].itemList[t],!1,o.isAscii),d("The Returned MC Buffer is:",2),d(i,2),d("The returned buffer length is "+i.length,2),i.copy(o.readReq,r),r+=i.length;d("The final send buffer is:",2),o.isAscii?(d(S(o.readReq.slice(0,r)),2),d(L(S(o.readReq.slice(0,r))),2)):d(o.readReq.slice(0,r),2),4==o.isoConnectionState?(o.readPacketArray[e].timeout=setTimeout((function(){o.packetTimeout.apply(o,arguments)}),o.globalTimeout,"read",o.readPacketArray[e].seqNum),o.isAscii?o.isoclient.write(S(o.readReq.slice(0,r))):o.isoclient.write(o.readReq.slice(0,r)),o.readPacketArray[e].sent=!0,o.readPacketArray[e].rcvd=!1,o.readPacketArray[e].timeoutError=!1,o.parallelJobsNow+=1,d("Sending Read Packet SEQ "+o.readPacketArray[e].seqNum,1)):(o.readPacketArray[e].sent=!0,o.readPacketArray[e].rcvd=!1,o.readPacketArray[e].timeoutError=!0,n||d("Not Sending Read Packet because we are not connected - ISO CS is "+o.isoConnectionState,0,o.connectionID),0==o.isoConnectionState&&(n=!0),d("Requesting PacketTimeout Due to ISO CS NOT 4 - READ SN "+o.readPacketArray[e].seqNum,1,o.connectionID),o.readPacketArray[e].timeout=setTimeout((function(){o.packetTimeout.apply(o,arguments)}),0,"read",o.readPacketArray[e].seqNum))}n&&setTimeout((function(){d("The scheduled reconnect from sendReadPacket is happening now",1,o.connectionID),o.connectNow(o.connectionParams)}),0)},a.prototype.sendWritePacket=function(){var e,t,r=this,o=!1;for(new Buffer(8192),r.writeInQueue=!1,i=0;i<r.writePacketArray.length;i++)if(!(r.writePacketArray[i].sent||r.parallelJobsNow>=r.maxParallel)){r.writePacketArray[i].reqTime=process.hrtime(),e=0,0;for(var n=0;n<r.writePacketArray[i].itemList.length;n++)(t=g(r.writePacketArray[i].itemList[n],!0,r.isAscii)).copy(r.writeReq,e),e+=t.length;if(d("The returned buffer length is "+t.length,1),4===r.isoConnectionState)r.writePacketArray[i].timeout=setTimeout((function(){r.packetTimeout.apply(r,arguments)}),r.globalTimeout,"write",r.writePacketArray[i].seqNum),d("Actual Send Packet:",2),d(r.writeReq.slice(0,e),2),r.isAscii?r.isoclient.write(S(r.writeReq.slice(0,e))):r.isoclient.write(r.writeReq.slice(0,e)),r.writePacketArray[i].sent=!0,r.writePacketArray[i].rcvd=!1,r.writePacketArray[i].timeoutError=!1,r.parallelJobsNow+=1,d("Sending Write Packet With Sequence Number "+r.writePacketArray[i].seqNum,1,r.connectionID);else{r.writePacketArray[i].sent=!0,r.writePacketArray[i].rcvd=!1,r.writePacketArray[i].timeoutError=!0;var s=r.writePacketArray[i].seqNum;process.nextTick((function(){r.packetTimeout("write",s)})),0==r.isoConnectionState&&(o=!0)}}o&&setTimeout((function(){d("The scheduled reconnect from sendWritePacket is happening now",1,r.connectionID),r.connectNow(r.connectionParams)}),0)},a.prototype.isOptimizableArea=function(e){return!this.doNotOptimize},a.prototype.onResponse=function(e){var t,r,i;if(this.isAscii){if(void 0===(i=L(e)))return d("Failed ASCII conversion to binary on reply. Ignoring packet."),d(i,0),null}else i=e;return d("onResponse called with length "+i.length,1),i.length<2?(d("DATA LESS THAN 2 BYTES RECEIVED.  NO PROCESSING WILL OCCUR - CONNECTION RESET."),d(i,0),this.connectionReset(),null):(d("Valid MC Response Received (not yet checked for error)",1),d("Received "+i.length+" bytes of data from PLC.",1),d(i,2),this.isReading()&&(t=!0,d("Received Read Response",1),this.readResponse(i)),this.isWriting()&&(r=!0,d("Received Write Response",1),this.writeResponse(i)),t||r?void 0:(d("Sequence number that arrived wasn't a write or read reply - dropping"),d(i,0),null))},a.prototype.writeResponse=function(e){var t,r,i,o=2;for(packetCounter=0;packetCounter<this.writePacketArray.length;packetCounter++)if(this.writePacketArray[packetCounter].sent&&!this.writePacketArray[packetCounter].rcvd){i=packetCounter;break}if(void 0===i)return d("WARNING: Received a write packet when none marked as sent",0,this.connectionID),null;if(this.writePacketArray[i].rcvd)return d("WARNING: Received a write packet that was already marked as received",0,this.connectionID),null;for(itemCount=0;itemCount<this.writePacketArray[i].itemList.length;itemCount++)if(!(o=c(e,this.writePacketArray[i].itemList[itemCount],o))){d("Stopping Processing Write Response Packet due to unrecoverable packet error");break}if(this.writePacketArray[i].reqTime=process.hrtime(this.writePacketArray[i].reqTime),d("Time is "+this.writePacketArray[i].reqTime[0]+" seconds and "+Math.round(10*this.writePacketArray[i].reqTime[1]/1e6)/10+" ms.",1),this.writePacketArray[i].rcvd||(this.writePacketArray[i].rcvd=!0,this.parallelJobsNow--),clearTimeout(this.writePacketArray[i].timeout),this.writePacketArray.every(l)){for(t=0;t<this.writePacketArray.length;t++)this.writePacketArray[t].sent=!1,this.writePacketArray[t].rcvd=!1;for(r=!1,t=0;t<this.globalWriteBlockList.length;t++)f(this.globalWriteBlockList[t]),d(this.globalWriteBlockList[t].addr+" write completed with quality "+this.globalWriteBlockList[t].writeQuality,0),y(this.globalWriteBlockList[t].writeQuality)||(r=!0);this.writeDoneCallback,this.writeDoneCallback(r)}else this.sendWritePacket(),d("Sending again",1)},a.prototype.readResponse=function(e){var t,r,i=21,o={};for(d("ReadResponse called",1,this.connectionID),packetCounter=0;packetCounter<this.readPacketArray.length;packetCounter++)if(this.readPacketArray[packetCounter].sent&&!this.readPacketArray[packetCounter].rcvd){r=packetCounter;break}if(void 0===r)return d("WARNING: Received a read response packet that was not marked as sent",0,this.connectionID),null;if(this.readPacketArray[r].rcvd)return d("WARNING: Received a read response packet that was already marked as received",0,this.connectionID),null;for(itemCount=0;itemCount<this.readPacketArray[r].itemList.length;itemCount++)(i=u(e,this.readPacketArray[r].itemList[itemCount],i))||void 0===e||d("Received a ZERO RESPONSE Processing Read Packet due to unrecoverable packet error");if(this.readPacketArray[r].reqTime=process.hrtime(this.readPacketArray[r].reqTime),d("Read Time is "+this.readPacketArray[r].reqTime[0]+" seconds and "+Math.round(10*this.readPacketArray[r].reqTime[1]/1e6)/10+" ms.",1,this.connectionID),this.readPacketArray[r].rcvd||(this.readPacketArray[r].rcvd=!0,this.parallelJobsNow--,this.parallelJobsNow<0&&(this.parallelJobsNow=0)),clearTimeout(this.readPacketArray[r].timeout),this.readPacketArray.every(l)){for(d("Every packet done sending",1,this.connectionID),n=0;n<this.readPacketArray.length;n++)this.readPacketArray[n].sent=!1,this.readPacketArray[n].rcvd=!1;t=!1;for(var n=0;n<this.globalReadBlockList.length;n++){for(var s=0,a=0;a<this.globalReadBlockList[n].requestReference.length;a++)this.globalReadBlockList[n].requestReference[a].byteBuffer.copy(this.globalReadBlockList[n].byteBuffer,s,0,this.globalReadBlockList[n].requestReference[a].byteLength),this.globalReadBlockList[n].requestReference[a].qualityBuffer.copy(this.globalReadBlockList[n].qualityBuffer,s,0,this.globalReadBlockList[n].requestReference[a].byteLength),s+=this.globalReadBlockList[n].requestReference[a].byteLength;for(var c=0;c<this.globalReadBlockList[n].itemReference.length;c++)p(this.globalReadBlockList[n].itemReference[c],this.isAscii),d("Address "+this.globalReadBlockList[n].itemReference[c].addr+" has value "+this.globalReadBlockList[n].itemReference[c].value+" and quality "+this.globalReadBlockList[n].itemReference[c].quality,1,this.connectionID),y(this.globalReadBlockList[n].itemReference[c].quality)?o[this.globalReadBlockList[n].itemReference[c].useraddr]=this.globalReadBlockList[n].itemReference[c].value:(t=!0,o[this.globalReadBlockList[n].itemReference[c].useraddr]=this.globalReadBlockList[n].itemReference[c].quality)}d("We are calling back our readDoneCallback.",1,this.connectionID),this.readDoneCallback,this.readDoneCallback(t,o),this.resetPending&&this.resetNow(),!this.isReading()&&this.writeInQueue&&this.sendWritePacket()}else d("Calling SRP from RR",1,this.connectionID),this.sendReadPacket()},a.prototype.onClientDisconnect=function(){d("EIP/TCP DISCONNECTED."),this.connectionCleanup(),this.tryingToConnectNow=!1},a.prototype.connectionReset=function(){var e=this;e.isoConnectionState=0,e.resetPending=!0,d("ConnectionReset is happening"),e.isReading()||void 0!==e.resetTimeout||(e.resetTimeout=setTimeout((function(){e.resetNow.apply(e,arguments)}),1500))},a.prototype.resetNow=function(){this.isoConnectionState=0,this.isoclient.end(),d("ResetNOW is happening"),this.resetPending=!1,void 0!==this.resetTimeout&&(clearTimeout(this.resetTimeout),this.resetTimeout=void 0,d("Clearing an earlier scheduled reset"))},a.prototype.connectionCleanup=function(){this.isoConnectionState=0,d("Connection cleanup is happening"),void 0!==this.isoclient&&(this.isoclient.removeAllListeners("data"),this.isoclient.removeAllListeners("error"),this.isoclient.removeAllListeners("connect"),this.isoclient.removeAllListeners("end")),clearTimeout(this.connectTimeout),clearTimeout(this.PDUTimeout),this.clearReadPacketTimeouts(),this.clearWritePacketTimeouts()}},function(e,t,r){(function(){var r=this,i=r._,o={},n=Array.prototype,s=Object.prototype,a=Function.prototype,d=n.push,l=n.slice,u=n.concat,c=s.toString,f=s.hasOwnProperty,p=n.forEach,h=n.map,y=n.reduce,g=n.reduceRight,b=n.filter,m=n.every,v=n.some,I=n.indexOf,D=n.lastIndexOf,w=Array.isArray,B=Object.keys,A=a.bind,R=function(e){return e instanceof R?e:this instanceof R?void(this._wrapped=e):new R(e)};e.exports&&(t=e.exports=R),t._=R,R.VERSION="1.4.4";var k=R.each=R.forEach=function(e,t,r){if(null!=e)if(p&&e.forEach===p)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,n=e.length;i<n;i++)if(t.call(r,e[i],i,e)===o)return}else for(var s in e)if(R.has(e,s)&&t.call(r,e[s],s,e)===o)return};R.map=R.collect=function(e,t,r){var i=[];return null==e?i:h&&e.map===h?e.map(t,r):(k(e,(function(e,o,n){i[i.length]=t.call(r,e,o,n)})),i)};var C="Reduce of empty array with no initial value";R.reduce=R.foldl=R.inject=function(e,t,r,i){var o=arguments.length>2;if(null==e&&(e=[]),y&&e.reduce===y)return i&&(t=R.bind(t,i)),o?e.reduce(t,r):e.reduce(t);if(k(e,(function(e,n,s){o?r=t.call(i,r,e,n,s):(r=e,o=!0)})),!o)throw new TypeError(C);return r},R.reduceRight=R.foldr=function(e,t,r,i){var o=arguments.length>2;if(null==e&&(e=[]),g&&e.reduceRight===g)return i&&(t=R.bind(t,i)),o?e.reduceRight(t,r):e.reduceRight(t);var n=e.length;if(n!==+n){var s=R.keys(e);n=s.length}if(k(e,(function(a,d,l){d=s?s[--n]:--n,o?r=t.call(i,r,e[d],d,l):(r=e[d],o=!0)})),!o)throw new TypeError(C);return r},R.find=R.detect=function(e,t,r){var i;return L(e,(function(e,o,n){if(t.call(r,e,o,n))return i=e,!0})),i},R.filter=R.select=function(e,t,r){var i=[];return null==e?i:b&&e.filter===b?e.filter(t,r):(k(e,(function(e,o,n){t.call(r,e,o,n)&&(i[i.length]=e)})),i)},R.reject=function(e,t,r){return R.filter(e,(function(e,i,o){return!t.call(r,e,i,o)}),r)},R.every=R.all=function(e,t,r){t||(t=R.identity);var i=!0;return null==e?i:m&&e.every===m?e.every(t,r):(k(e,(function(e,n,s){if(!(i=i&&t.call(r,e,n,s)))return o})),!!i)};var L=R.some=R.any=function(e,t,r){t||(t=R.identity);var i=!1;return null==e?i:v&&e.some===v?e.some(t,r):(k(e,(function(e,n,s){if(i||(i=t.call(r,e,n,s)))return o})),!!i)};R.contains=R.include=function(e,t){return null!=e&&(I&&e.indexOf===I?-1!=e.indexOf(t):L(e,(function(e){return e===t})))},R.invoke=function(e,t){var r=l.call(arguments,2),i=R.isFunction(t);return R.map(e,(function(e){return(i?t:e[t]).apply(e,r)}))},R.pluck=function(e,t){return R.map(e,(function(e){return e[t]}))},R.where=function(e,t,r){return R.isEmpty(t)?r?null:[]:R[r?"find":"filter"](e,(function(e){for(var r in t)if(t[r]!==e[r])return!1;return!0}))},R.findWhere=function(e,t){return R.where(e,t,!0)},R.max=function(e,t,r){if(!t&&R.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&R.isEmpty(e))return-1/0;var i={computed:-1/0,value:-1/0};return k(e,(function(e,o,n){var s=t?t.call(r,e,o,n):e;s>=i.computed&&(i={value:e,computed:s})})),i.value},R.min=function(e,t,r){if(!t&&R.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&R.isEmpty(e))return 1/0;var i={computed:1/0,value:1/0};return k(e,(function(e,o,n){var s=t?t.call(r,e,o,n):e;s<i.computed&&(i={value:e,computed:s})})),i.value},R.shuffle=function(e){var t,r=0,i=[];return k(e,(function(e){t=R.random(r++),i[r-1]=i[t],i[t]=e})),i};var S=function(e){return R.isFunction(e)?e:function(t){return t[e]}};R.sortBy=function(e,t,r){var i=S(t);return R.pluck(R.map(e,(function(e,t,o){return{value:e,index:t,criteria:i.call(r,e,t,o)}})).sort((function(e,t){var r=e.criteria,i=t.criteria;if(r!==i){if(r>i||void 0===r)return 1;if(r<i||void 0===i)return-1}return e.index<t.index?-1:1})),"value")};var j=function(e,t,r,i){var o={},n=S(t||R.identity);return k(e,(function(t,s){var a=n.call(r,t,s,e);i(o,a,t)})),o};R.groupBy=function(e,t,r){return j(e,t,r,(function(e,t,r){(R.has(e,t)?e[t]:e[t]=[]).push(r)}))},R.countBy=function(e,t,r){return j(e,t,r,(function(e,t){R.has(e,t)||(e[t]=0),e[t]++}))},R.sortedIndex=function(e,t,r,i){for(var o=(r=null==r?R.identity:S(r)).call(i,t),n=0,s=e.length;n<s;){var a=n+s>>>1;r.call(i,e[a])<o?n=a+1:s=a}return n},R.toArray=function(e){return e?R.isArray(e)?l.call(e):e.length===+e.length?R.map(e,R.identity):R.values(e):[]},R.size=function(e){return null==e?0:e.length===+e.length?e.length:R.keys(e).length},R.first=R.head=R.take=function(e,t,r){if(null!=e)return null==t||r?e[0]:l.call(e,0,t)},R.initial=function(e,t,r){return l.call(e,0,e.length-(null==t||r?1:t))},R.last=function(e,t,r){if(null!=e)return null==t||r?e[e.length-1]:l.call(e,Math.max(e.length-t,0))},R.rest=R.tail=R.drop=function(e,t,r){return l.call(e,null==t||r?1:t)},R.compact=function(e){return R.filter(e,R.identity)};var E=function(e,t,r){return k(e,(function(e){R.isArray(e)?t?d.apply(r,e):E(e,t,r):r.push(e)})),r};R.flatten=function(e,t){return E(e,t,[])},R.without=function(e){return R.difference(e,l.call(arguments,1))},R.uniq=R.unique=function(e,t,r,i){R.isFunction(t)&&(i=r,r=t,t=!1);var o=r?R.map(e,r,i):e,n=[],s=[];return k(o,(function(r,i){(t?i&&s[s.length-1]===r:R.contains(s,r))||(s.push(r),n.push(e[i]))})),n},R.union=function(){return R.uniq(u.apply(n,arguments))},R.intersection=function(e){var t=l.call(arguments,1);return R.filter(R.uniq(e),(function(e){return R.every(t,(function(t){return R.indexOf(t,e)>=0}))}))},R.difference=function(e){var t=u.apply(n,l.call(arguments,1));return R.filter(e,(function(e){return!R.contains(t,e)}))},R.zip=function(){for(var e=l.call(arguments),t=R.max(R.pluck(e,"length")),r=new Array(t),i=0;i<t;i++)r[i]=R.pluck(e,""+i);return r},R.object=function(e,t){if(null==e)return{};for(var r={},i=0,o=e.length;i<o;i++)t?r[e[i]]=t[i]:r[e[i][0]]=e[i][1];return r},R.indexOf=function(e,t,r){if(null==e)return-1;var i=0,o=e.length;if(r){if("number"!=typeof r)return e[i=R.sortedIndex(e,t)]===t?i:-1;i=r<0?Math.max(0,o+r):r}if(I&&e.indexOf===I)return e.indexOf(t,r);for(;i<o;i++)if(e[i]===t)return i;return-1},R.lastIndexOf=function(e,t,r){if(null==e)return-1;var i=null!=r;if(D&&e.lastIndexOf===D)return i?e.lastIndexOf(t,r):e.lastIndexOf(t);for(var o=i?r:e.length;o--;)if(e[o]===t)return o;return-1},R.range=function(e,t,r){arguments.length<=1&&(t=e||0,e=0),r=arguments[2]||1;for(var i=Math.max(Math.ceil((t-e)/r),0),o=0,n=new Array(i);o<i;)n[o++]=e,e+=r;return n},R.bind=function(e,t){if(e.bind===A&&A)return A.apply(e,l.call(arguments,1));var r=l.call(arguments,2);return function(){return e.apply(t,r.concat(l.call(arguments)))}},R.partial=function(e){var t=l.call(arguments,1);return function(){return e.apply(this,t.concat(l.call(arguments)))}},R.bindAll=function(e){var t=l.call(arguments,1);return 0===t.length&&(t=R.functions(e)),k(t,(function(t){e[t]=R.bind(e[t],e)})),e},R.memoize=function(e,t){var r={};return t||(t=R.identity),function(){var i=t.apply(this,arguments);return R.has(r,i)?r[i]:r[i]=e.apply(this,arguments)}},R.delay=function(e,t){var r=l.call(arguments,2);return setTimeout((function(){return e.apply(null,r)}),t)},R.defer=function(e){return R.delay.apply(R,[e,1].concat(l.call(arguments,1)))},R.throttle=function(e,t){var r,i,o,n,s=0,a=function(){s=new Date,o=null,n=e.apply(r,i)};return function(){var d=new Date,l=t-(d-s);return r=this,i=arguments,l<=0?(clearTimeout(o),o=null,s=d,n=e.apply(r,i)):o||(o=setTimeout(a,l)),n}},R.debounce=function(e,t,r){var i,o;return function(){var n=this,s=arguments,a=function(){i=null,r||(o=e.apply(n,s))},d=r&&!i;return clearTimeout(i),i=setTimeout(a,t),d&&(o=e.apply(n,s)),o}},R.once=function(e){var t,r=!1;return function(){return r||(r=!0,t=e.apply(this,arguments),e=null),t}},R.wrap=function(e,t){return function(){var r=[e];return d.apply(r,arguments),t.apply(this,r)}},R.compose=function(){var e=arguments;return function(){for(var t=arguments,r=e.length-1;r>=0;r--)t=[e[r].apply(this,t)];return t[0]}},R.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},R.keys=B||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var r in e)R.has(e,r)&&(t[t.length]=r);return t},R.values=function(e){var t=[];for(var r in e)R.has(e,r)&&t.push(e[r]);return t},R.pairs=function(e){var t=[];for(var r in e)R.has(e,r)&&t.push([r,e[r]]);return t},R.invert=function(e){var t={};for(var r in e)R.has(e,r)&&(t[e[r]]=r);return t},R.functions=R.methods=function(e){var t=[];for(var r in e)R.isFunction(e[r])&&t.push(r);return t.sort()},R.extend=function(e){return k(l.call(arguments,1),(function(t){if(t)for(var r in t)e[r]=t[r]})),e},R.pick=function(e){var t={},r=u.apply(n,l.call(arguments,1));return k(r,(function(r){r in e&&(t[r]=e[r])})),t},R.omit=function(e){var t={},r=u.apply(n,l.call(arguments,1));for(var i in e)R.contains(r,i)||(t[i]=e[i]);return t},R.defaults=function(e){return k(l.call(arguments,1),(function(t){if(t)for(var r in t)null==e[r]&&(e[r]=t[r])})),e},R.clone=function(e){return R.isObject(e)?R.isArray(e)?e.slice():R.extend({},e):e},R.tap=function(e,t){return t(e),e};var x=function(e,t,r,i){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof R&&(e=e._wrapped),t instanceof R&&(t=t._wrapped);var o=c.call(e);if(o!=c.call(t))return!1;switch(o){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var n=r.length;n--;)if(r[n]==e)return i[n]==t;r.push(e),i.push(t);var s=0,a=!0;if("[object Array]"==o){if(a=(s=e.length)==t.length)for(;s--&&(a=x(e[s],t[s],r,i)););}else{var d=e.constructor,l=t.constructor;if(d!==l&&!(R.isFunction(d)&&d instanceof d&&R.isFunction(l)&&l instanceof l))return!1;for(var u in e)if(R.has(e,u)&&(s++,!(a=R.has(t,u)&&x(e[u],t[u],r,i))))break;if(a){for(u in t)if(R.has(t,u)&&!s--)break;a=!s}}return r.pop(),i.pop(),a};R.isEqual=function(e,t){return x(e,t,[],[])},R.isEmpty=function(e){if(null==e)return!0;if(R.isArray(e)||R.isString(e))return 0===e.length;for(var t in e)if(R.has(e,t))return!1;return!0},R.isElement=function(e){return!(!e||1!==e.nodeType)},R.isArray=w||function(e){return"[object Array]"==c.call(e)},R.isObject=function(e){return e===Object(e)},k(["Arguments","Function","String","Number","Date","RegExp"],(function(e){R["is"+e]=function(t){return c.call(t)=="[object "+e+"]"}})),R.isArguments(arguments)||(R.isArguments=function(e){return!(!e||!R.has(e,"callee"))}),R.isFunction=function(e){return"function"==typeof e},R.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},R.isNaN=function(e){return R.isNumber(e)&&e!=+e},R.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==c.call(e)},R.isNull=function(e){return null===e},R.isUndefined=function(e){return void 0===e},R.has=function(e,t){return f.call(e,t)},R.noConflict=function(){return r._=i,this},R.identity=function(e){return e},R.times=function(e,t,r){for(var i=Array(e),o=0;o<e;o++)i[o]=t.call(r,o);return i},R.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var W={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};W.unescape=R.invert(W.escape);var _={escape:new RegExp("["+R.keys(W.escape).join("")+"]","g"),unescape:new RegExp("("+R.keys(W.unescape).join("|")+")","g")};R.each(["escape","unescape"],(function(e){R[e]=function(t){return null==t?"":(""+t).replace(_[e],(function(t){return W[e][t]}))}})),R.result=function(e,t){if(null==e)return null;var r=e[t];return R.isFunction(r)?r.call(e):r},R.mixin=function(e){k(R.functions(e),(function(t){var r=R[t]=e[t];R.prototype[t]=function(){var e=[this._wrapped];return d.apply(e,arguments),T.call(this,r.apply(R,e))}}))};var O=0;R.uniqueId=function(e){var t=++O+"";return e?e+t:t},R.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var U=/(.)^/,P={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},N=/\\|'|\r|\n|\t|\u2028|\u2029/g;R.template=function(e,t,r){var i;r=R.defaults({},r,R.templateSettings);var o=new RegExp([(r.escape||U).source,(r.interpolate||U).source,(r.evaluate||U).source].join("|")+"|$","g"),n=0,s="__p+='";e.replace(o,(function(t,r,i,o,a){return s+=e.slice(n,a).replace(N,(function(e){return"\\"+P[e]})),r&&(s+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),i&&(s+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),o&&(s+="';\n"+o+"\n__p+='"),n=a+t.length,t})),s+="';\n",r.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{i=new Function(r.variable||"obj","_",s)}catch(e){throw e.source=s,e}if(t)return i(t,R);var a=function(e){return i.call(this,e,R)};return a.source="function("+(r.variable||"obj")+"){\n"+s+"}",a},R.chain=function(e){return R(e).chain()};var T=function(e){return this._chain?R(e).chain():e};R.mixin(R),k(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=n[e];R.prototype[e]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!=e&&"splice"!=e||0!==r.length||delete r[0],T.call(this,r)}})),k(["concat","join","slice"],(function(e){var t=n[e];R.prototype[e]=function(){return T.call(this,t.apply(this._wrapped,arguments))}})),R.extend(R.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},function(e,t,r){var i=r(1);r(5),r(47).exec;e.exports=function(e,t){e.sockets.on("connection",(function(e){console.log("co nguoi ket noi"+e.id),e.emit("UpdateElement",i.resultElement),e.emit("UpdateBitAdjust",i.resultBitAdjust),e.emit("UpdateBitDisplay",i.resultBitDisplay),e.emit("UpdateWordAdjust",i.resultWordAdjust),e.emit("UpdateWordDisplay",i.resultWordDisplay),e.emit("UpdateDWordAdjust",i.resultDWordAdjust),e.emit("UpdateDWordDisplay",i.resultDWordDisplay),e.emit("UpdateTextField",i.resultTextField),e.on("disconnect",(function(){console.log("ngat kekt noi")})),e.on("initial",(function(){console.log("INITIAL"),e.emit("UpdateElement",i.resultElement),e.emit("UpdateBitAdjust",i.resultBitAdjust),e.emit("UpdateBitDisplay",i.resultBitDisplay),e.emit("UpdateWordAdjust",i.resultWordAdjust),e.emit("UpdateWordDisplay",i.resultWordDisplay),e.emit("UpdateDWordAdjust",i.resultDWordAdjust),e.emit("UpdateDWordDisplay",i.resultDWordDisplay),e.emit("UpdateTextField",i.resultTextField)})),e.on("Client-send-data",(function(e){if(console.log(e),"ElementForce_Run"!==e.NameCommand||isNaN(e.tag)||t.writeItems("ComPC",[100,100,e.tag,e.tag],()=>{console.log("can not write data Mitsubishi")}),"ElementForce_Stop"!==e.NameCommand||isNaN(e.tag)||t.writeItems("ComPC",[101,101,e.tag,e.tag],()=>{console.log("can not write data Mitsubishi")}),"ElementForce_Auto"!==e.NameCommand||isNaN(e.tag)||t.writeItems("ComPC",[102,102,e.tag,e.tag],()=>{console.log("can not write data Mitsubishi")}),"ElementForce_Interlock"!==e.NameCommand||isNaN(e.tag)||t.writeItems("ComPC",[103,103,e.tag,e.tag],()=>{console.log("can not write data Mitsubishi")}),"BitAdjustForce"!==e.NameCommand||isNaN(e.tag)||t.writeItems("ComPC",[110,110,e.mode,e.mode,e.tag,e.tag],()=>{console.log("can not write data Mitsubishi")}),"WordAdjustForce"!==e.NameCommand||isNaN(e.tag)||t.writeItems("ComPC",[111,111,e.tag,e.tag,e.value,e.value],()=>{console.log("can not write data Mitsubishi")}),"DWordAdjustForce"===e.NameCommand&&!isNaN(e.tag)){var r=parseInt(e.value/65536),i=parseInt(e.value%65536);t.writeItems("ComPC",[112,112,e.tag,e.tag,r,r,i,i],()=>{console.log("can not write data Mitsubishi")})}}))}))}},function(e,t,r){var i=r(1),o=r(23),n=r(15),s=r(16),a=r(14),d=r(21),l=r(22),u=r(17),c=r(18),f=r(19),p=r(20),h=r(24),y=r(25),g=r(95),b=r(26),m=r(27),v=r(5);e.exports=function(e){i.refreshDataBitAdjust=!0,i.refreshDataBitDisplay=!0,i.refreshDataDWordAdjust=!0,i.refreshDataDWordDisplay=!0,i.refreshDataElement=!0,i.refreshDataImage=!0,i.refreshDataLabel=!0,i.refreshDataPanel=!0,i.refreshDataWordAdjust=!0,i.refreshDataWordDisplay=!0,i.refreshDataTextField=!0,i.refreshDataTextFieldInput=!0,i.refreshDataPosCobot=!0,i.refreshDataBitDisplayImageLibrary=!0,i.refreshDataElementImageLibrary=!0,setInterval((function(){try{i.refreshDataPanel&&(i.refreshDataPanel=!1,o.find().limit(1e3).sort().select({parent:1,width:1,height:1,left:1,top:1,margin:1,backgroundColor:1,padding:1,borderRadius:1,boxShadow1:1,boxShadow2:1,boxShadow3:1,boxShadowColor:1,zIndex:1}).exec((t,r)=>{t?console.log("get data from db error"):(i.resultPanel=r,v.saveJsonFile("./Store/Database/Panel.json",r),e.sockets.emit("UpdatePanel",i.resultPanel),console.log("Get modelPanel data successfull",r.length))}))}catch(e){}}),200),setInterval((function(){try{if(i.refreshDataElement&&(i.refreshDataElement=!1,a.find({}).limit(1e3).sort({left:1}).select({parent:1,tag:1,left:1,top:1,nameElement:1,src:1,state_m:1,state_cm:1,state_F0:1,state_F1:1,state_Fault:1,state_Interlock:1}).exec((t,r)=>{if(t)console.log("get data from db error");else{for(let e=0;e<r.length;e++)isNaN(parseInt(r[e].tag))?(r[e].state_m=0,r[e].state_cm=0,r[e].state_f0=0,r[e].state_F1=0,r[e].state_Fault=0,r[e].state_Interlock=0):parseInt(r[e].tag)<=i.Element.length&&(2&i.Element[r[e].tag]?r[e].state_m=1:r[e].state_m=0,4&i.Element[r[e].tag]?r[e].state_cm=1:r[e].state_cm=0,8&i.Element[r[e].tag]?r[e].state_F0=1:r[e].state_F0=0,16&i.Element[r[e].tag]?r[e].state_F1=1:r[e].state_F1=0,32&i.Element[r[e].tag]?r[e].state_Fault=1:r[e].state_Fault=0,128&i.Element[r[e].tag]?r[e].state_Interlock=1:r[e].state_Interlock=0);i.resultElement=r,v.saveJsonFile("./Store/Database/Element.json",r),e.sockets.emit("UpdateElement",i.resultElement),console.log("Get modelElement data successfull",r.length)}})),i.haveChangeElement&&i.resultElement.length>0){i.haveChangeElement=!1;for(let e=0;e<i.resultElement.length;e++)isNaN(parseInt(i.resultElement[e].tag))?(i.resultElement[e].state_m=0,i.resultElement[e].state_cm=0,i.resultElement[e].state_f0=0,i.resultElement[e].state_F1=0,i.resultElement[e].state_Fault=0,i.resultElement[e].state_Interlock=0):parseInt(i.resultElement[e].tag)<=i.Element.length&&(2&i.Element[i.resultElement[e].tag]?i.resultElement[e].state_m=1:i.resultElement[e].state_m=0,4&i.Element[i.resultElement[e].tag]?i.resultElement[e].state_cm=1:i.resultElement[e].state_cm=0,8&i.Element[i.resultElement[e].tag]?i.resultElement[e].state_F0=1:i.resultElement[e].state_F0=0,16&i.Element[i.resultElement[e].tag]?i.resultElement[e].state_F1=1:i.resultElement[e].state_F1=0,32&i.Element[i.resultElement[e].tag]?i.resultElement[e].state_Fault=1:i.resultElement[e].state_Fault=0,128&i.Element[i.resultElement[e].tag]?i.resultElement[e].state_Interlock=1:i.resultElement[e].state_Interlock=0);e.sockets.emit("UpdateElement",i.resultElement),console.log("Get modelElement data successfull",Element.length)}}catch(e){}}),200),setInterval((function(){try{i.refreshDataLine&&(i.refreshDataLine=!1,s.find({}).limit(1e3).sort({x:1}).select({parent:1,left:1,top:1,length:1,idRun:1,type:1}).exec((t,r)=>{t?console.log("get data from db error"):(i.resultline=r,v.saveJsonFile("./Store/Database/Lines.json",r),e.sockets.emit("UpdateLine",i.resultline),console.log("Get modelLines data successfull"))}))}catch(e){}}),200),setInterval((function(){try{i.refreshDataLabel&&(i.refreshDataLabel=!1,n.find({}).limit(1e3).sort({left:1}).select({parent:1,left:1,top:1,text:1,color:1,fontSize:1,width:1}).exec((t,r)=>{t?console.log("get data from db error"):(i.resultlabel=r,v.saveJsonFile("./Store/Database/Labels.json",r),e.sockets.emit("UpdateLabel",i.resultlabel),console.log("Get modelLabel data successfull",r.length))}))}catch(e){}}),200),setInterval((function(){try{if(i.refreshDataBitAdjust&&(i.refreshDataBitAdjust=!1,l.find({}).limit(1e3).sort({left:1}).select({parent:1,status:1,text:1,fontSize:1,tag:1,left:1,top:1,width:1,height:1,type:1}).exec((t,r)=>{if(t)console.log("get data from db error");else{for(let e=0;e<r.length;e++)r[e].tag<=i.BitAdjust.length&&(r[e].status=i.BitAdjust[r[e].tag]);i.resultBitAdjust=r,v.saveJsonFile("./Store/Database/BitAdjust.json",r),e.sockets.emit("UpdateBitAdjust",i.resultBitAdjust),console.log("Get modelBitAdjust data successfull",r.length)}})),i.haveChangeBitAdjust&&i.resultBitAdjust.length>0){i.haveChangeBitAdjust=!1;for(let e=0;e<i.resultBitAdjust.length;e++)i.resultBitAdjust[e].tag<=i.BitAdjust.length&&(i.resultBitAdjust[e].status=i.BitAdjust[i.resultBitAdjust[e].tag]);e.sockets.emit("UpdateBitAdjust",i.resultBitAdjust),console.log(i.haveChangeBitAdjust)}}catch(e){}}),200),setInterval((function(){try{if(i.refreshDataBitDisplay&&(i.refreshDataBitDisplay=!1,d.find({}).limit(1e3).sort({left:1}).select({parent:1,status:1,text0:1,text1:1,color0:1,color1:1,nameImage0:1,nameImage1:1,fontSize:1,tag:1,left:1,top:1,width:1,type:1}).exec((t,r)=>{if(t)console.log("get data from db error");else{for(let e=0;e<r.length;e++)r[e].tag<=i.BitDisplay.length&&(r[e].status=i.BitDisplay[r[e].tag]);i.resultBitDisplay=r,v.saveJsonFile("./Store/Database/BitDisplay.json",r),e.sockets.emit("UpdateBitDisplay",i.resultBitDisplay),console.log("Get modelBitDisplay data successfull",r.length)}})),i.haveChangeBitDisplay&&i.resultBitDisplay.length>0){i.haveChangeBitDisplay=!1;for(let e=0;e<i.resultBitDisplay.length;e++)i.resultBitDisplay[e].tag<=i.BitDisplay.length&&(i.resultBitDisplay[e].status=i.BitDisplay[i.resultBitDisplay[e].tag]);e.sockets.emit("UpdateBitDisplay",i.resultBitDisplay)}}catch(e){}}),200),setInterval((function(){try{if(i.refreshDataWordDisplay&&(i.refreshDataWordDisplay=!1,u.find({}).limit(1e3).sort({left:1}).select({parent:1,tag:1,text:1,fontSize:1,left:1,top:1,width:1}).exec((t,r)=>{if(t)console.log("get data from db error");else{for(let e=0;e<r.length;e++)r[e].tag<=i.WordDisplay.length?r[e].text=i.WordDisplay[r[e].tag]:r[e].text="???";i.resultWordDisplay=r,v.saveJsonFile("./Store/Database/WordDisplay.json",r),e.sockets.emit("UpdateWordDisplay",i.resultWordDisplay),console.log("Get modelWordDisplay data successfull",r.length)}})),i.haveChangeWordDisplay&&i.resultWordDisplay.length>0){i.haveChangeWordDisplay=!1;for(let e=0;e<i.resultWordDisplay.length;e++)i.resultWordDisplay[e].tag<=i.WordDisplay.length?i.resultWordDisplay[e].text=i.WordDisplay[i.resultWordDisplay[e].tag]:i.resultWordDisplay[e].text="???";e.sockets.emit("UpdateWordDisplay",i.resultWordDisplay)}}catch(e){}}),200),setInterval((function(){try{if(i.refreshDataWordAdjust&&(i.refreshDataWordAdjust=!1,c.find({}).limit(1e3).sort({left:1}).select({parent:1,tag:1,text:1,fontSize:1,left:1,top:1,width:1,height:1}).exec((t,r)=>{if(t)console.log("get data from db error");else{for(let e=0;e<r.length;e++)r[e].tag<=i.WordAdjust.length?r[e].text=i.WordAdjust[r[e].tag]:r[e].text="???";i.resultWordAdjust=r,v.saveJsonFile("./Store/Database/WordAdjust.json",r),e.sockets.emit("UpdateWordAdjust",i.resultWordAdjust),console.log("Get modelWordAdjust data successfull",r.length)}})),i.haveChangeWordAdjust&&i.resultWordAdjust.length>0){i.haveChangeWordAdjust=!1;for(let e=0;e<i.resultWordAdjust.length;e++)i.resultWordAdjust[e].tag<=i.WordAdjust.length?i.resultWordAdjust[e].text=i.WordAdjust[i.resultWordAdjust[e].tag]:i.resultWordAdjust[e].text="???";e.sockets.emit("UpdateWordAdjust",i.resultWordAdjust)}}catch(e){}}),200),setInterval((function(){try{if(i.refreshDataDWordDisplay&&(i.refreshDataDWordDisplay=!1,f.find({}).limit(1e3).sort({left:1}).select({parent:1,tag:1,text:1,fontSize:1,left:1,top:1,width:1}).exec((t,r)=>{if(t)console.log("get data from db error");else{for(let e=0;e<r.length;e++)r[e].tag<=i.DWordDisplay.length?r[e].text=i.DWordDisplay[r[e].tag]:r[e].text="???";i.resultDWordDisplay=r,v.saveJsonFile("./Store/Database/DWordDisplay.json",r),e.sockets.emit("UpdateDWordDisplay",i.resultDWordDisplay),console.log("Get modelDWordDisplay data successfull",r.length)}})),i.haveChangeDWordDisplay&&i.resultDWordDisplay.length>0){i.haveChangeDWordDisplay=!1;for(let e=0;e<i.resultDWordDisplay.length;e++)i.resultDWordDisplay[e].tag<=i.DWordDisplay.length?i.resultDWordDisplay[e].text=i.DWordDisplay[i.resultDWordDisplay[e].tag]:i.resultDWordDisplay[e].text="???";e.sockets.emit("UpdateDWordDisplay",i.resultDWordDisplay)}}catch(e){}}),200),setInterval((function(){try{if(i.refreshDataDWordAdjust&&(i.refreshDataDWordAdjust=!1,p.find({}).limit(1e3).sort({left:1}).select({parent:1,tag:1,text:1,fontSize:1,left:1,top:1,width:1,height:1}).exec((t,r)=>{if(t)console.log("get data from db error");else{for(let e=0;e<r.length;e++)r[e].tag<=i.DWordAdjust.length?r[e].text=i.DWordAdjust[r[e].tag]:r[e].text="???";i.resultDWordAdjust=r,v.saveJsonFile("./Store/Database/DWordAdjust.json",r),e.sockets.emit("UpdateDWordAdjust",i.resultDWordAdjust),console.log("Get modelDWordAdjust data successfull",r.length)}})),i.haveChangeDWordAdjust&&i.resultDWordAdjust.length>0){i.haveChangeDWordAdjust=!1;for(let e=0;e<i.resultDWordAdjust.length;e++)i.resultDWordAdjust[e].tag<=i.DWordAdjust.length?i.resultDWordAdjust[e].text=i.DWordAdjust[i.resultDWordAdjust[e].tag]:i.resultDWordAdjust[e].text="???";e.sockets.emit("UpdateDWordAdjust",i.resultDWordAdjust)}}catch(e){}}),200),setInterval((function(){try{if(i.refreshDataTextField&&(i.refreshDataTextField=!1,h.find({}).limit(1e3).sort({left:1}).select({parent:1,tag:1,label:1,value:1,fontSize:1,left:1,top:1,width:1,color:1,fontSize:1,rows:1}).exec((t,r)=>{t?console.log("get data from db error"):(i.resultTextField=r,v.saveJsonFile("./Store/Database/TextField.json",r),e.sockets.emit("UpdateTextField",i.resultTextField),console.log("Get modelTextField data successfull",r.length))})),i.haveChangeTextField&&i.resultTextField.length>0){i.haveChangeTextField=!1;for(let e=0;e<i.resultTextField.length;e++)i.resultTextField[e].tag<=i.TextField.length?i.resultTextField[e].value=i.TextField[i.resultTextField[e].tag]:i.resultTextField[e].value="???";e.sockets.emit("UpdateTextField",i.resultTextField)}}catch(e){}}),200),setInterval((function(){try{i.refreshDataTextFieldInput&&(i.refreshDataTextFieldInput=!1,y.find({}).limit(1e3).sort({left:1}).select({parent:1,tag:1,label:1,value:1,fontSize:1,left:1,top:1,width:1,color:1,fontSize:1,rows:1,text:1}).exec((t,r)=>{t?console.log("get data from db error"):(i.resultTextFieldInput=r,v.saveJsonFile("./Store/Database/TextFieldInput.json",r),e.sockets.emit("UpdateTextFieldInput",i.resultTextFieldInput),console.log("Get modelTextField data successfull",r.length))})),i.haveChangeTextFieldInput&&i.resultTextFieldInput.length>0&&(i.haveChangeTextFieldInput=!1,e.sockets.emit("UpdateTextFieldInput",i.resultTextFieldInput))}catch(e){}}),200),setInterval((function(){try{i.refreshDataPosCobot&&(i.refreshDataPosCobot=!1,g.find({}).limit(5e3).sort({time:1}).select({parent:1,type:1,x:1,y:1,z:1,yaw:1,pitch:1,roll:1,time:1}).exec((e,t)=>{e?console.log("get data from db error"):(i.resultPosCobot=t,console.log("Get Pos Cobot data successfull"))}))}catch(e){}}),200),setInterval((function(){try{i.refreshDataBitDisplayImageLibrary&&(i.refreshDataBitDisplayImageLibrary=!1,b.find({}).limit(1e3).sort({date:1}).select({name:1,img:1}).exec((t,r)=>{t?console.log("get data from db error"):(i.resultBitDisplayImageLibrary=r,e.sockets.emit("UpdateBitDisplayImageLibrary",i.resultBitDisplayImageLibrary),console.log("Get Image Library data successfull"),console.log(i.resultBitDisplayImageLibrary.length))}))}catch(e){}}),200),setInterval((function(){try{i.refreshDataElementImageLibrary&&(i.refreshDataElementImageLibrary=!1,m.find({}).sort("-date").limit(1e3).select({name:1,imgRun:1,imgStop:1,imgFault:1,imgLock:1,date:1}).exec((t,r)=>{t?console.log("get data from db error"):(i.resultElementImageLibrary=r,e.sockets.emit("UpdateElementImageLibrary",i.resultElementImageLibrary),console.log("Get Element Library data successfull"),console.log(i.resultElementImageLibrary.length))}))}catch(e){}}),200)}},function(e,t,r){var i=r(0),o=new(0,i.Schema)({parent:{type:String,default:""},type:{type:String,default:""},x:{type:Number,required:!0},y:{type:Number,required:!0},z:{type:Number,required:!0},yaw:{type:Number,required:!0},pitch:{type:Number,required:!0},roll:{type:Number,required:!0},time:{type:Date,required:!0}});e.exports=i.model("posCobots",o)}]);
//# sourceMappingURL=index.js.map